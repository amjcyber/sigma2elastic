{"id":"0c2f8629-7129-4a8a-9897-7e0768f13ff2","created_by":"Ivan Dyachkov, oscd.community","name":"Execution via Diskshadow.exe","tags":["attack.execution","attack.t1218"],"interval":"5m","description":"Detects using Diskshadow.exe to execute arbitrary code in text file","risk_score":73,"enabled":true,"severity":"high","false_positives":["False postitve can be if administrators use diskshadow tool in their infrastructure as a main backup tool with scripts."],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.executable:/.*\\\\[Dd][Ii][Ss][Kk][Ss][Hh][Aa][Dd][Oo][Ww]\\.[Ee][Xx][Ee]/ AND process.command_line:(/.*\\/[Ss].*/ OR /.*\\-[Ss].*/))","rule_id":"0c2f8629-7129-4a8a-9897-7e0768f13ff2","timestamp_override":"event.ingested","references":["https://bohops.com/2018/03/26/diskshadow-the-return-of-vss-evasion-persistence-and-active-directory-database-extraction/","https://www.ired.team/offensive-security/credential-access-and-credential-dumping/ntds.dit-enumeration"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.executable:*\\\\diskshadow.exe AND process.command_line:(*\\/s* OR *\\-s*))`"}
