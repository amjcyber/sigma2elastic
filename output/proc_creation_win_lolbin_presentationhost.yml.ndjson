{"id":"d22e2925-cfd8-463f-96f6-89cec9d9bc5f","created_by":"Nasreddine Bencherchali","name":"Application Whitelisting Bypass via PresentationHost.exe","tags":["attack.defense_evasion","attack.execution","attack.t1218"],"interval":"5m","description":"Detects usage of \"PresentationHost\" which is a utility that runs \".xbap\" (Browser Applications) files. It can be abused to run malicious \".xbap\" files any bypass AWL","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Legitimate \".xbap\" being executed via \"PresentationHost\""],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(((process.executable:/.*\\\\[Pp][Rr][Ee][Ss][Ee][Nn][Tt][Aa][Tt][Ii][Oo][Nn][Hh][Oo][Ss][Tt]\\.[Ee][Xx][Ee]/ OR process.pe.original_file_name:/[Pp][Rr][Ee][Ss][Ee][Nn][Tt][Aa][Tt][Ii][Oo][Nn][Hh][Oo][Ss][Tt]\\.[Ee][Xx][Ee]/) AND process.command_line:/.*\\.[Xx][Bb][Aa][Pp].*/) AND (NOT (process.command_line:(/.*[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\.*/ OR /.*[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss].*/))))","rule_id":"d22e2925-cfd8-463f-96f6-89cec9d9bc5f","timestamp_override":"event.ingested","references":["https://lolbas-project.github.io/lolbas/Binaries/Presentationhost/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(((process.executable:*\\\\presentationhost.exe OR process.pe.original_file_name:PresentationHost.exe) AND process.command_line:*.xbap*) AND (NOT (process.command_line:(*C\\:\\\\Windows\\\\* OR *C\\:\\\\Program\\ Files*))))`"}
