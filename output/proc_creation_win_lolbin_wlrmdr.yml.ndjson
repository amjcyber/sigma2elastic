{"id":"9cfc00b6-bfb7-49ce-9781-ef78503154bb","created_by":"frack113","name":"Wlrmdr Lolbin Use as Launcher","tags":["attack.defense_evasion"],"interval":"5m","description":"Detects use of Wlrmdr.exe in which the -u parameter is passed to ShellExecute","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:/.*\\\\[Ww][Ll][Rr][Mm][Dd][Rr]\\.[Ee][Xx][Ee]/ AND process.command_line:/.*\\-[Ss]\\ .*/ AND process.command_line:/.*\\-[Ff]\\ .*/ AND process.command_line:/.*\\-[Tt]\\ .*/ AND process.command_line:/.*\\-[Mm]\\ .*/ AND process.command_line:/.*\\-[Aa]\\ .*/ AND process.command_line:/.*\\-[Uu]\\ .*/) AND (NOT (process.parent.executable:/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Ww][Ii][Nn][Ll][Oo][Gg][Oo][Nn]\\.[Ee][Xx][Ee]/)))","rule_id":"9cfc00b6-bfb7-49ce-9781-ef78503154bb","timestamp_override":"event.ingested","references":["https://twitter.com/0gtweet/status/1493963591745220608?s=20&t=xUg9DsZhJy1q9bPTUWgeIQ"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:*\\\\wlrmdr.exe AND process.command_line:*\\-s\\ * AND process.command_line:*\\-f\\ * AND process.command_line:*\\-t\\ * AND process.command_line:*\\-m\\ * AND process.command_line:*\\-a\\ * AND process.command_line:*\\-u\\ *) AND (NOT (process.parent.executable:C\\:\\\\Windows\\\\System32\\\\winlogon.exe)))`"}
