{"id":"36480ae1-a1cb-4eaa-a0d6-29801d7e9142","created_by":"Matthew Green - @mgreen27, Ecco, James Pemberton / @4A616D6573, oscd.community (improvements), Andreas Hunkeler (@Karneades)","name":"Renamed Binary","tags":["attack.defense_evasion","attack.t1036.003"],"interval":"5m","description":"Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist","PsExec installed via Windows Store doesn't contain original filename field (False negative)"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.pe.original_file_name:(/[Cc][Mm][Dd]\\.[Ee][Xx][Ee]/ OR /[Cc][Oo][Nn][Hh][Oo][Ss][Tt]\\.[Ee][Xx][Ee]/ OR /[Pp][Oo][Ww][Ee][Rr][Ss][Hh][Ee][Ll][Ll]\\.[Ee][Xx][Ee]/ OR /[Pp][Ww][Ss][Hh]\\.[Dd][Ll][Ll]/ OR /[Pp][Oo][Ww][Ee][Rr][Ss][Hh][Ee][Ll][Ll]_[Ii][Ss][Ee]\\.[Ee][Xx][Ee]/ OR /[Pp][Ss][Ee][Xx][Ee][Cc]\\.[Ee][Xx][Ee]/ OR /[Pp][Ss][Ee][Xx][Ee][Cc]\\.[Cc]/ OR /[Cc][Ss][Cc][Rr][Ii][Pp][Tt]\\.[Ee][Xx][Ee]/ OR /[Ww][Ss][Cc][Rr][Ii][Pp][Tt]\\.[Ee][Xx][Ee]/ OR /[Mm][Ss][Hh][Tt][Aa]\\.[Ee][Xx][Ee]/ OR /[Rr][Ee][Gg][Ss][Vv][Rr]32\\.[Ee][Xx][Ee]/ OR /[Ww][Mm][Ii][Cc]\\.[Ee][Xx][Ee]/ OR /[Cc][Ee][Rr][Tt][Uu][Tt][Ii][Ll]\\.[Ee][Xx][Ee]/ OR /[Rr][Uu][Nn][Dd][Ll][Ll]32\\.[Ee][Xx][Ee]/ OR /[Cc][Mm][Ss][Tt][Pp]\\.[Ee][Xx][Ee]/ OR /[Mm][Ss][Ii][Ee][Xx][Ee][Cc]\\.[Ee][Xx][Ee]/ OR /7[Zz]\\.[Ee][Xx][Ee]/ OR /[Ww][Ii][Nn][Rr][Aa][Rr]\\.[Ee][Xx][Ee]/ OR /[Ww][Ee][Vv][Tt][Uu][Tt][Ii][Ll]\\.[Ee][Xx][Ee]/ OR /[Nn][Ee][Tt]\\.[Ee][Xx][Ee]/ OR /[Nn][Ee][Tt]1\\.[Ee][Xx][Ee]/ OR /[Nn][Ee][Tt][Ss][Hh]\\.[Ee][Xx][Ee]/) AND (NOT (process.executable:(/.*\\\\[Cc][Mm][Dd]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Cc][Oo][Nn][Hh][Oo][Ss][Tt]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Oo][Ww][Ee][Rr][Ss][Hh][Ee][Ll][Ll]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Ww][Ss][Hh]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Oo][Ww][Ee][Rr][Ss][Hh][Ee][Ll][Ll]_[Ii][Ss][Ee]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Ss][Ee][Xx][Ee][Cc]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Ss][Ee][Xx][Ee][Cc]64\\.[Ee][Xx][Ee]/ OR /.*\\\\[Cc][Ss][Cc][Rr][Ii][Pp][Tt]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ww][Ss][Cc][Rr][Ii][Pp][Tt]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Mm][Ss][Hh][Tt][Aa]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Rr][Ee][Gg][Ss][Vv][Rr]32\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ww][Mm][Ii][Cc]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Cc][Ee][Rr][Tt][Uu][Tt][Ii][Ll]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Rr][Uu][Nn][Dd][Ll][Ll]32\\.[Ee][Xx][Ee]/ OR /.*\\\\[Cc][Mm][Ss][Tt][Pp]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Mm][Ss][Ii][Ee][Xx][Ee][Cc]\\.[Ee][Xx][Ee]/ OR /.*\\\\7[Zz]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ww][Ii][Nn][Rr][Aa][Rr]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ww][Ee][Vv][Tt][Uu][Tt][Ii][Ll]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Nn][Ee][Tt]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Nn][Ee][Tt]1\\.[Ee][Xx][Ee]/ OR /.*\\\\[Nn][Ee][Tt][Ss][Hh]\\.[Ee][Xx][Ee]/))))","rule_id":"36480ae1-a1cb-4eaa-a0d6-29801d7e9142","timestamp_override":"event.ingested","references":["https://attack.mitre.org/techniques/T1036/","https://mgreen27.github.io/posts/2019/05/12/BinaryRename.html","https://mgreen27.github.io/posts/2019/05/29/BinaryRename2.html"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.pe.original_file_name:(Cmd.Exe OR CONHOST.EXE OR PowerShell.EXE OR pwsh.dll OR powershell_ise.EXE OR psexec.exe OR psexec.c OR cscript.exe OR wscript.exe OR MSHTA.EXE OR REGSVR32.EXE OR wmic.exe OR CertUtil.exe OR RUNDLL32.EXE OR CMSTP.EXE OR msiexec.exe OR 7z.exe OR WinRAR.exe OR wevtutil.exe OR net.exe OR net1.exe OR netsh.exe) AND (NOT (process.executable:(*\\\\cmd.exe OR *\\\\conhost.exe OR *\\\\powershell.exe OR *\\\\pwsh.exe OR *\\\\powershell_ise.exe OR *\\\\psexec.exe OR *\\\\psexec64.exe OR *\\\\cscript.exe OR *\\\\wscript.exe OR *\\\\mshta.exe OR *\\\\regsvr32.exe OR *\\\\WMIC.exe OR *\\\\certutil.exe OR *\\\\rundll32.exe OR *\\\\cmstp.exe OR *\\\\msiexec.exe OR *\\\\7z.exe OR *\\\\WinRAR.exe OR *\\\\wevtutil.exe OR *\\\\net.exe OR *\\\\net1.exe OR *\\\\netsh.exe))))`"}
