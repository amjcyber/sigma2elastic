{"id":"4cbef972-f347-4170-b62a-8253f6168e6d","created_by":"Nasreddine Bencherchali","name":"UAC Bypass Using IDiagnostic Profile","tags":["attack.execution","attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"interval":"5m","description":"Detects the \"IDiagnosticProfileUAC\" UAC bypass technique","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.parent.executable:/.*\\\\[Dd][Ll][Ll][Hh][Oo][Ss][Tt]\\.[Ee][Xx][Ee]/ AND process.parent.command_line:/.*\\ \\/[Pp][Rr][Oo][Cc][Ee][Ss][Ss][Ii][Dd]\\:\\{12[Cc]21[Ee][Aa]7\\-2[Ee][Bb]8\\-4[Bb]55\\-9249\\-[Aa][Cc]243[Dd][Aa]8[Cc]666\\}.*/ AND winlog.event_data.IntegrityLevel:(/[Hh][Ii][Gg][Hh]/ OR /[Ss][Yy][Ss][Tt][Ee][Mm]/))","rule_id":"4cbef972-f347-4170-b62a-8253f6168e6d","timestamp_override":"event.ingested","references":["https://github.com/Wh04m1001/IDiagnosticProfileUAC"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.parent.executable:*\\\\DllHost.exe AND process.parent.command_line:*\\ \\/Processid\\:\\{12C21EA7\\-2EB8\\-4B55\\-9249\\-AC243DA8C666\\}* AND winlog.event_data.IntegrityLevel:(High OR System))`"}
