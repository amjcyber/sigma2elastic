{"id":"bf6c39fc-e203-45b9-9538-05397c1b4f3f","created_by":"Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative, Nasreddine Bencherchali","name":"Abusing Findstr for Defense Evasion","tags":["attack.defense_evasion","attack.t1218","attack.t1564.004","attack.t1552.001","attack.t1105"],"interval":"5m","description":"Attackers can use findstr to hide their artifacts or search specific strings and evade defense mechanism","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Administrative findstr usage"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.command_line:/.*[Ff][Ii][Nn][Dd][Ss][Tt][Rr].*/ OR process.executable:/.*[Ff][Ii][Nn][Dd][Ss][Tt][Rr]\\.[Ee][Xx][Ee]/ OR process.pe.original_file_name:/[Ff][Ii][Nn][Dd][Ss][Tt][Rr]\\.[Ee][Xx][Ee]/) AND ((process.command_line:(/.*\\/[Vv].*/ OR /.*\\-[Vv].*/) AND process.command_line:(/.*\\/[Ll].*/ OR /.*\\-[Ll].*/)) OR (process.command_line:(/.*\\/[Ss].*/ OR /.*\\-[Ss].*/) AND process.command_line:(/.*\\/[Ii].*/ OR /.*\\-[Ii].*/))))","rule_id":"bf6c39fc-e203-45b9-9538-05397c1b4f3f","timestamp_override":"event.ingested","references":["https://lolbas-project.github.io/lolbas/Binaries/Findstr/","https://oddvar.moe/2018/04/11/putting-data-in-alternate-data-streams-and-how-to-execute-it-part-2/","https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.command_line:*findstr* OR process.executable:*findstr.exe OR process.pe.original_file_name:FINDSTR.EXE) AND ((process.command_line:(*\\/v* OR *\\-v*) AND process.command_line:(*\\/l* OR *\\-l*)) OR (process.command_line:(*\\/s* OR *\\-s*) AND process.command_line:(*\\/i* OR *\\-i*))))`"}
