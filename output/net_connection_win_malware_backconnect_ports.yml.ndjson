{"id":"4b89abaa-99fe-4232-afdd-8f9aa4d20382","created_by":"Florian Roth","name":"Suspicious Typical Malware Back Connect Ports","tags":["attack.command_and_control","attack.t1571"],"interval":"5m","description":"Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((network.direction:/[Tt][Rr][Uu][Ee]/ AND destination.port:(4443 OR 2448 OR 8143 OR 1777 OR 1443 OR 243 OR 65535 OR 13506 OR 3360 OR 200 OR 198 OR 49180 OR 13507 OR 6625 OR 4444 OR 4438 OR 1904 OR 13505 OR 13504 OR 12102 OR 9631 OR 5445 OR 2443 OR 777 OR 13394 OR 13145 OR 12103 OR 5552 OR 3939 OR 3675 OR 666 OR 473 OR 5649 OR 4455 OR 4433 OR 1817 OR 100 OR 65520 OR 1960 OR 1515 OR 743 OR 700 OR 14154 OR 14103 OR 14102 OR 12322 OR 10101 OR 7210 OR 4040 OR 9943)) AND (NOT ((process.executable:/.*\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss].*/) OR (destination.ip:(/10\\..*/ OR /192\\.168\\..*/ OR /172\\.16\\..*/ OR /172\\.17\\..*/ OR /172\\.18\\..*/ OR /172\\.19\\..*/ OR /172\\.20\\..*/ OR /172\\.21\\..*/ OR /172\\.22\\..*/ OR /172\\.23\\..*/ OR /172\\.24\\..*/ OR /172\\.25\\..*/ OR /172\\.26\\..*/ OR /172\\.27\\..*/ OR /172\\.28\\..*/ OR /172\\.29\\..*/ OR /172\\.30\\..*/ OR /172\\.31\\..*/ OR /127\\..*/)))))","rule_id":"4b89abaa-99fe-4232-afdd-8f9aa4d20382","timestamp_override":"event.ingested","references":["https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((network.direction:true AND destination.port:(4443 OR 2448 OR 8143 OR 1777 OR 1443 OR 243 OR 65535 OR 13506 OR 3360 OR 200 OR 198 OR 49180 OR 13507 OR 6625 OR 4444 OR 4438 OR 1904 OR 13505 OR 13504 OR 12102 OR 9631 OR 5445 OR 2443 OR 777 OR 13394 OR 13145 OR 12103 OR 5552 OR 3939 OR 3675 OR 666 OR 473 OR 5649 OR 4455 OR 4433 OR 1817 OR 100 OR 65520 OR 1960 OR 1515 OR 743 OR 700 OR 14154 OR 14103 OR 14102 OR 12322 OR 10101 OR 7210 OR 4040 OR 9943)) AND (NOT ((process.executable:*\\\\Program\\ Files*) OR (destination.ip:(10.* OR 192.168.* OR 172.16.* OR 172.17.* OR 172.18.* OR 172.19.* OR 172.20.* OR 172.21.* OR 172.22.* OR 172.23.* OR 172.24.* OR 172.25.* OR 172.26.* OR 172.27.* OR 172.28.* OR 172.29.* OR 172.30.* OR 172.31.* OR 127.*)))))`"}
