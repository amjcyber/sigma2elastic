{"id":"828af599-4c53-4ed2-ba4a-a9f835c434ea","created_by":"NVISO","name":"Fax Service DLL Search Order Hijack","tags":["attack.persistence","attack.defense_evasion","attack.t1574.001","attack.t1574.002"],"interval":"5m","description":"The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service.","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unlikely"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:/.*\\\\[Ff][Xx][Ss][Ss][Vv][Cc]\\.[Ee][Xx][Ee]/ AND file.path:/.*[Uu][Aa][Ll][Aa][Pp][Ii]\\.[Dd][Ll][Ll]/) AND (NOT (file.path:/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ww][Ii][Nn][Ss][Xx][Ss]\\\\.*/)))","rule_id":"828af599-4c53-4ed2-ba4a-a9f835c434ea","timestamp_override":"event.ingested","references":["https://windows-internals.com/faxing-your-way-to-system/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:*\\\\fxssvc.exe AND file.path:*ualapi.dll) AND (NOT (file.path:C\\:\\\\Windows\\\\WinSxS\\\\*)))`"}
