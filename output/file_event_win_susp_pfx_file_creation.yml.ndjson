{"id":"dca1b3e8-e043-4ec8-85d7-867f334b5724","created_by":"Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","name":"Suspicious PFX File Creation","tags":["attack.credential_access","attack.t1552.004"],"interval":"5m","description":"A general detection for processes creating PFX files. This could be an indicator of an adversary exporting a local certificate to a PFX file.","risk_score":47,"enabled":true,"severity":"medium","false_positives":["System administrators managing certififcates."],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(file.path:/.*\\.[Pp][Ff][Xx]/ AND (NOT ((file.path:/.*\\\\[Tt][Ee][Mm][Pp][Ll][Aa][Tt][Ee][Ss]\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]_[Tt][Ee][Mm][Pp][Oo][Rr][Aa][Rr][Yy][Kk][Ee][Yy]\\.[Pp][Ff][Xx].*/ AND file.path:/.*\\\\[Cc][Mm][Aa][Kk][Ee]\\\\.*/))))","rule_id":"dca1b3e8-e043-4ec8-85d7-867f334b5724","timestamp_override":"event.ingested","references":["https://github.com/OTRF/detection-hackathon-apt29/issues/14","https://threathunterplaybook.com/evals/apt29/detections/6.B.1_6392C9F1-D975-4F75-8A70-433DEDD7F622.html"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(file.path:*.pfx AND (NOT ((file.path:*\\\\Templates\\\\Windows\\\\Windows_TemporaryKey.pfx* AND file.path:*\\\\CMake\\\\*))))`"}
