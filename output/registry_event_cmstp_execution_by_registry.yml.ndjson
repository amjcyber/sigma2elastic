{"id":"b6d235fc-1d38-4b12-adbe-325f06728f37","created_by":"Nik Seetharaman","name":"CMSTP Execution Registry Event","tags":["attack.defense_evasion","attack.execution","attack.t1218.003","attack.g0069","car.2019-04-001"],"interval":"5m","description":"Detects various indicators of Microsoft Connection Manager Profile Installer execution","risk_score":73,"enabled":true,"severity":"high","false_positives":["Legitimate CMSTP use (unlikely in modern enterprise environments)"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"registry.path:/.*\\\\[Cc][Mm][Mm][Gg][Rr]32\\.[Ee][Xx][Ee].*/","rule_id":"b6d235fc-1d38-4b12-adbe-325f06728f37","timestamp_override":"event.ingested","references":["https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`registry.path:*\\\\cmmgr32.exe*`"}
