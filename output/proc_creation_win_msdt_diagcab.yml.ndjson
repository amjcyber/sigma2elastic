{"id":"6545ce61-a1bd-4119-b9be-fcbee42c0cf3","created_by":"GossiTheDog (rule), frack113 (sigma version)","name":"Execute MSDT.EXE Using Diagcab File","tags":["attack.defense_evasion","attack.t1202"],"interval":"5m","description":"Detects diagcab leveraging the \"ms-msdt\" handler or the \"msdt.exe\" binary to execute arbitrary commands as seen in CVE-2022-30190","risk_score":73,"enabled":true,"severity":"high","false_positives":["Legitimate usage of \".diagcab\" files"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:/.*\\\\[Mm][Ss][Dd][Tt]\\.[Ee][Xx][Ee]/ OR process.pe.original_file_name:/[Mm][Ss][Dd][Tt]\\.[Ee][Xx][Ee]/) AND (process.command_line:/.*\\/[Cc][Aa][Bb].*/ AND process.command_line:/.*\\.[Dd][Ii][Aa][Gg][Cc][Aa][Bb].*/))","rule_id":"6545ce61-a1bd-4119-b9be-fcbee42c0cf3","timestamp_override":"event.ingested","references":["https://github.com/GossiTheDog/ThreatHunting/blob/e85884abbf05d5b41efc809ea6532b10b45bd05c/AdvancedHuntingQueries/DogWalk-DiagCab"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:*\\\\msdt.exe OR process.pe.original_file_name:msdt.exe) AND (process.command_line:*\\/cab* AND process.command_line:*.diagcab*))`"}
