{"id":"4e64668a-4da1-49f5-a8df-9e2d5b866718","created_by":"Florian Roth, KevTheHermit, fuzzyf10w, Tim Shelton","name":"Possible CVE-2021-1675 Print Spooler Exploitation","tags":["attack.execution","attack.t1569","cve.2021.1675"],"interval":"5m","description":"Detects events of driver load errors in print service logs that could be a sign of successful exploitation attempts of print spooler vulnerability CVE-2021-1675","risk_score":73,"enabled":true,"severity":"high","false_positives":["Problems with printer drivers"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(winlog.channel:Microsoft\\-Windows\\-PrintService\\/Admin AND ((event.code:(808 OR 4909) AND winlog.event_data.ErrorCode:(/0[Xx]45[Aa]/ OR /0[Xx]7[Ee]/)) OR \\*.keyword:(/.*[Tt][Hh][Ee]\\ [Pp][Rr][Ii][Nn][Tt]\\ [Ss][Pp][Oo][Oo][Ll][Ee][Rr]\\ [Ff][Aa][Ii][Ll][Ee][Dd]\\ [Tt][Oo]\\ [Ll][Oo][Aa][Dd]\\ [Aa]\\ [Pp][Ll][Uu][Gg]\\-[Ii][Nn]\\ [Mm][Oo][Dd][Uu][Ll][Ee].*/ OR /.*[Mm][Yy][Ee][Xx][Pp][Ll][Oo][Ii][Tt]\\.[Dd][Ll][Ll].*/ OR /.*[Ee][Vv][Ii][Ll]\\.[Dd][Ll][Ll].*/ OR /.*\\\\[Aa][Dd][Dd][Cc][Uu][Bb][Ee]\\.[Dd][Ll][Ll].*/ OR /.*\\\\[Rr][Ee][Vv]\\.[Dd][Ll][Ll].*/ OR /.*\\\\[Rr][Ee][Vv]2\\.[Dd][Ll][Ll].*/ OR /.*\\\\[Mm][Aa][Ii][Nn]64\\.[Dd][Ll][Ll].*/ OR /.*\\\\[Mm][Ii][Mm][Ii][Ll][Ii][Bb]\\.[Dd][Ll][Ll].*/ OR /.*\\\\[Mm][Ii][Mm][Ii][Ss][Pp][Oo][Oo][Ll]\\.[Dd][Ll][Ll].*/)) AND (NOT \\*.keyword:(/.*\\ [Rr][Ee][Gg][Ii][Ss][Tt][Rr][Aa][Tt][Ii][Oo][Nn]\\ [Tt][Ii][Mm][Ee][Dd]\\ [Oo][Uu][Tt].*/)))","rule_id":"4e64668a-4da1-49f5-a8df-9e2d5b866718","timestamp_override":"event.ingested","references":["https://github.com/hhlxf/PrintNightmare","https://github.com/afwu/PrintNightmare","https://twitter.com/fuzzyf10w/status/1410202370835898371"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(winlog.channel:Microsoft\\-Windows\\-PrintService\\/Admin AND ((event.code:(808 OR 4909) AND winlog.event_data.ErrorCode:(0x45A OR 0x7e)) OR \\*.keyword:(*The\\ print\\ spooler\\ failed\\ to\\ load\\ a\\ plug\\-in\\ module* OR *MyExploit.dll* OR *evil.dll* OR *\\\\addCube.dll* OR *\\\\rev.dll* OR *\\\\rev2.dll* OR *\\\\main64.dll* OR *\\\\mimilib.dll* OR *\\\\mimispool.dll*)) AND (NOT \\*.keyword:(*\\ registration\\ timed\\ out*)))`"}
