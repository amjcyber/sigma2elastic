{"id":"09af397b-c5eb-4811-b2bb-08b3de464ebf","created_by":"frack113","name":"WMI Reconnaissance List Remote Services","tags":["attack.execution","attack.t1047"],"interval":"5m","description":"An adversary might use WMI to check if a certain Remote Service is running on a remote device.\nWhen the test completes, a service information will be displayed on the screen if it exists.\nA common feedback message is that \"No instance(s) Available\" if the service queried is not running.\nA common error message is \"Node - (provided IP or default) ERROR Description =The RPC server is unavailable\" if the provided remote host is unreachable\n","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:/.*\\\\[Ww][Mm][Ii][Cc]\\.[Ee][Xx][Ee]/ OR process.pe.original_file_name:/[Ww][Mm][Ii][Cc]\\.[Ee][Xx][Ee]/) AND (process.command_line:/.*\\/[Nn][Oo][Dd][Ee]\\:.*/ AND process.command_line:/.*[Ss][Ee][Rr][Vv][Ii][Cc][Ee].*/))","rule_id":"09af397b-c5eb-4811-b2bb-08b3de464ebf","timestamp_override":"event.ingested","references":["https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1047/T1047.md","https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wmic"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:*\\\\WMIC.exe OR process.pe.original_file_name:wmic.exe) AND (process.command_line:*\\/node\\:* AND process.command_line:*service*))`"}
