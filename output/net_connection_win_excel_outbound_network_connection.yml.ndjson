{"id":"75e33ce3-ae32-4dcc-9aa8-a2a3029d6f84","created_by":"Christopher Peacock '@securepeacock', SCYTHE '@scythe_io', Florian Roth '@Neo23x0\", Tim Shelton","name":"Excel Network Connections","tags":["attack.execution","attack.t1203"],"interval":"5m","description":"Detects an Excel process that opens suspicious network connections to non-private IP addresses, and attempts to cover CVE-2021-42292. You will likely have to tune this rule for your organization, but it is certainly something you should look for and could have applications for malicious activity beyond CVE-2021-42292.","risk_score":47,"enabled":true,"severity":"medium","false_positives":["You may have to tune certain domains out that Excel may call out to, such as microsoft or other business use case domains.","Office documents commonly have templates that refer to external addresses, like sharepoint.ourcompany.com may have to be tuned.","It is highly recommended to baseline your activity and tune out common business use cases."],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:/.*\\\\[Ee][Xx][Cc][Ee][Ll]\\.[Ee][Xx][Ee]/ AND network.direction:/[Tt][Rr][Uu][Ee]/ AND DestinationIsIpv6:/[Ff][Aa][Ll][Ss][Ee]/) AND (NOT (destination.ip:(/10\\..*/ OR /192\\.168\\..*/ OR /172\\.16\\..*/ OR /172\\.17\\..*/ OR /172\\.18\\..*/ OR /172\\.19\\..*/ OR /172\\.20\\..*/ OR /172\\.21\\..*/ OR /172\\.22\\..*/ OR /172\\.23\\..*/ OR /172\\.24\\..*/ OR /172\\.25\\..*/ OR /172\\.26\\..*/ OR /172\\.27\\..*/ OR /172\\.28\\..*/ OR /172\\.29\\..*/ OR /172\\.30\\..*/ OR /172\\.31\\..*/ OR /127\\.0\\.0\\.1.*/))))","rule_id":"75e33ce3-ae32-4dcc-9aa8-a2a3029d6f84","timestamp_override":"event.ingested","references":["https://corelight.com/blog/detecting-cve-2021-42292"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:*\\\\excel.exe AND network.direction:true AND DestinationIsIpv6:false) AND (NOT (destination.ip:(10.* OR 192.168.* OR 172.16.* OR 172.17.* OR 172.18.* OR 172.19.* OR 172.20.* OR 172.21.* OR 172.22.* OR 172.23.* OR 172.24.* OR 172.25.* OR 172.26.* OR 172.27.* OR 172.28.* OR 172.29.* OR 172.30.* OR 172.31.* OR 127.0.0.1*))))`"}
