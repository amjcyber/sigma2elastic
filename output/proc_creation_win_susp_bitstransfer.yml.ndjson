{"id":"cd5c8085-4070-4e22-908d-a5b3342deb74","created_by":"Austin Songer @austinsonger","name":"Suspicious Bitstransfer via PowerShell","tags":["attack.exfiltration","attack.persistence","attack.t1197"],"interval":"5m","description":"Detects transferring files from system on a server bitstransfer Powershell cmdlets","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.executable:(/.*\\\\[Pp][Oo][Ww][Ee][Rr][Ss][Hh][Ee][Ll][Ll]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Oo][Ww][Ee][Rr][Ss][Hh][Ee][Ll][Ll]_[Ii][Ss][Ee]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Ww][Ss][Hh]\\.[Ee][Xx][Ee]/) AND process.command_line:(/.*[Gg][Ee][Tt]\\-[Bb][Ii][Tt][Ss][Tt][Rr][Aa][Nn][Ss][Ff][Ee][Rr].*/ OR /.*[Aa][Dd][Dd]\\-[Bb][Ii][Tt][Ss][Ff][Ii][Ll][Ee].*/))","rule_id":"cd5c8085-4070-4e22-908d-a5b3342deb74","timestamp_override":"event.ingested","references":["https://docs.microsoft.com/en-us/powershell/module/bitstransfer/add-bitsfile?view=windowsserver2019-ps"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.executable:(*\\\\powershell.exe OR *\\\\powershell_ise.exe OR *\\\\pwsh.exe) AND process.command_line:(*Get\\-BitsTransfer* OR *Add\\-BitsFile*))`"}
