{"id":"ed965133-513f-41d9-a441-e38076a0798f","created_by":"Florian Roth (rule)","name":"Suspicious PowerShell Invocations - Generic","tags":["attack.execution","attack.t1059.001"],"interval":"5m","description":"Detects suspicious PowerShell invocation command parameters","risk_score":73,"enabled":true,"severity":"high","false_positives":["Very special / sneaky PowerShell scripts"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(powershell.file.script_block_text:(/.*\\ \\-[Ee][Nn][Cc]\\ .*/ OR /.*\\ \\-[Ee][Nn][Cc][Oo][Dd][Ee][Dd][Cc][Oo][Mm][Mm][Aa][Nn][Dd]\\ .*/) AND powershell.file.script_block_text:(/.*\\ \\-[Ww]\\ [Hh][Ii][Dd][Dd][Ee][Nn]\\ .*/ OR /.*\\ \\-[Ww][Ii][Nn][Dd][Oo][Ww]\\ [Hh][Ii][Dd][Dd][Ee][Nn]\\ .*/ OR /.*\\ \\-[Ww][Ii][Nn][Dd][Oo][Ww][Ss][Tt][Yy][Ll][Ee]\\ [Hh][Ii][Dd][Dd][Ee][Nn]\\ .*/) AND powershell.file.script_block_text:(/.*\\ \\-[Nn][Oo][Nn][Ii]\\ .*/ OR /.*\\ \\-[Nn][Oo][Nn][Ii][Nn][Tt][Ee][Rr][Aa][Cc][Tt][Ii][Vv][Ee]\\ .*/))","rule_id":"ed965133-513f-41d9-a441-e38076a0798f","timestamp_override":"event.ingested","references":null,"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(powershell.file.script_block_text:(*\\ \\-enc\\ * OR *\\ \\-EncodedCommand\\ *) AND powershell.file.script_block_text:(*\\ \\-w\\ hidden\\ * OR *\\ \\-window\\ hidden\\ * OR *\\ \\-windowstyle\\ hidden\\ *) AND powershell.file.script_block_text:(*\\ \\-noni\\ * OR *\\ \\-noninteractive\\ *))`"}
