{"id":"06ce37c2-61ab-4f05-9ff5-b1a96d18ae32","created_by":"Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","name":"WMIC Loading Scripting Libraries","tags":["attack.defense_evasion","attack.t1220"],"interval":"5m","description":"Detects threat actors proxy executing code and bypassing application controls by leveraging wmic and the `/FORMAT` argument switch to download and execute an XSL file (i.e js, vbs, etc).","risk_score":73,"enabled":true,"severity":"high","false_positives":["Apparently, wmic os get lastboottuptime loads vbscript.dll"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.executable:/.*\\\\[Ww][Mm][Ii][Cc]\\.[Ee][Xx][Ee]/ AND file.path:(/.*\\\\[Jj][Ss][Cc][Rr][Ii][Pp][Tt]\\.[Dd][Ll][Ll]/ OR /.*\\\\[Vv][Bb][Ss][Cc][Rr][Ii][Pp][Tt]\\.[Dd][Ll][Ll]/))","rule_id":"06ce37c2-61ab-4f05-9ff5-b1a96d18ae32","timestamp_override":"event.ingested","references":["https://securitydatasets.com/notebooks/small/windows/05_defense_evasion/SDWIN-201017061100.html","https://twitter.com/dez_/status/986614411711442944","https://lolbas-project.github.io/lolbas/Binaries/Wmic/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.executable:*\\\\wmic.exe AND file.path:(*\\\\jscript.dll OR *\\\\vbscript.dll))`"}
