{"id":"c625d754-6a3d-4f65-9c9a-536aea960d37","created_by":"Teymur Kheirkhabarov (idea), Mangatas Tondang (rule), oscd.community, Nasreddine Bencherchali (modified)","name":"Accesschk Usage To Check Privileges","tags":["attack.discovery","attack.t1069.001"],"interval":"5m","description":"Accesschk is an access and privilege audit tool developed by SysInternal and often being used by attacker to verify privileges","risk_score":47,"enabled":true,"severity":"medium","false_positives":["System administrator Usage"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.pe.product:/.*[Aa][Cc][Cc][Ee][Ss][Ss][Cc][Hh][Kk]/ OR process.pe.description:/.*[Rr][Ee][Pp][Oo][Rr][Tt][Ss]\\ [Ee][Ff][Ff][Ee][Cc][Tt][Ii][Vv][Ee]\\ [Pp][Ee][Rr][Mm][Ii][Ss][Ss][Ii][Oo][Nn][Ss].*/ OR process.executable:/.*\\\\[Aa][Cc][Cc][Ee][Ss][Ss][Cc][Hh][Kk]\\.[Ee][Xx][Ee]/) AND process.command_line:(/.*[Uu][Ww][Cc][Qq][Vv]\\ .*/ OR /.*[Kk][Ww][Ss][Uu]\\ .*/ OR /.*[Qq][Ww][Ss][Uu]\\ .*/ OR /.*[Uu][Ww][Dd][Qq][Ss]\\ .*/))","rule_id":"c625d754-6a3d-4f65-9c9a-536aea960d37","timestamp_override":"event.ingested","references":["https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment?slide=43","https://www.youtube.com/watch?v=JGs-aKf2OtU&ab_channel=OFFZONEMOSCOW","https://github.com/carlospolop/PEASS-ng/blob/fa0f2e17fbc1d86f1fd66338a40e665e7182501d/winPEAS/winPEASbat/winPEAS.bat","https://github.com/gladiatx0r/Powerless/blob/04f553bbc0c65baf4e57344deff84e3f016e6b51/Powerless.bat"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.pe.product:*AccessChk OR process.pe.description:*Reports\\ effective\\ permissions* OR process.executable:*\\\\accesschk.exe) AND process.command_line:(*uwcqv\\ * OR *kwsu\\ * OR *qwsu\\ * OR *uwdqs\\ *))`"}
