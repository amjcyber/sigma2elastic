{"id":"5b572dcf-254b-425c-a8c5-d9af6bea35a6","created_by":"Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton","name":"Suspicious Encoded PowerShell Command Line","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"interval":"5m","description":"Detects specific combinations of encoding methods in the PowerShell command lines","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unlikely"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.executable:(/.*\\\\[Pp][Oo][Ww][Ee][Rr][Ss][Hh][Ee][Ll][Ll]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Ww][Ss][Hh]\\.[Ee][Xx][Ee]/) AND process.command_line:/.*[Ff][Oo][Rr][Ee][Aa][Cc][Hh].*/ AND process.command_line:/.*[Xx][Oo][Rr].*/)","rule_id":"5b572dcf-254b-425c-a8c5-d9af6bea35a6","timestamp_override":"event.ingested","references":["https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=65"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe) AND process.command_line:*ForEach* AND process.command_line:*Xor*)`"}
