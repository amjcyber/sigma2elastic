{"id":"a9b6c011-ab69-4ddb-bc0a-c4f21c80ec47","created_by":"Nasreddine Bencherchali","name":"Modify Attachment Manager Settings - Associations","tags":["attack.defense_evasion"],"interval":"5m","description":"Detects tampering with attachment manager settings policies associations to lower the default file type risks (See reference for more information)","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unlikely"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((winlog.event_data.EventType:/[Ss][Ee][Tt][Vv][Aa][Ll][Uu][Ee]/ AND registry.path:/.*\\\\[Ss][Oo][Ff][Tt][Ww][Aa][Rr][Ee]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Cc][Uu][Rr][Rr][Ee][Nn][Tt][Vv][Ee][Rr][Ss][Ii][Oo][Nn]\\\\[Pp][Oo][Ll][Ii][Cc][Ii][Ee][Ss]\\\\[Aa][Ss][Ss][Oo][Cc][Ii][Aa][Tt][Ii][Oo][Nn][Ss]\\\\.*/) AND ((registry.path:/.*\\\\[Dd][Ee][Ff][Aa][Uu][Ll][Tt][Ff][Ii][Ll][Ee][Tt][Yy][Pp][Ee][Rr][Ii][Ss][Kk]/ AND winlog.event_data.Details:/[Dd][Ww][Oo][Rr][Dd]\\ \\(0[Xx]00006152\\)/) OR (registry.path:/.*\\\\[Ll][Oo][Ww][Rr][Ii][Ss][Kk][Ff][Ii][Ll][Ee][Tt][Yy][Pp][Ee][Ss]/ AND winlog.event_data.Details:(/.*\\.[Zz][Ii][Pp];.*/ OR /.*\\.[Rr][Aa][Rr];.*/ OR /.*\\.[Ee][Xx][Ee];.*/ OR /.*\\.[Bb][Aa][Tt];.*/ OR /.*\\.[Cc][Oo][Mm];.*/ OR /.*\\.[Cc][Mm][Dd];.*/ OR /.*\\.[Rr][Ee][Gg];.*/ OR /.*\\.[Mm][Ss][Ii];.*/ OR /.*\\.[Hh][Tt][Mm];.*/ OR /.*\\.[Hh][Tt][Mm][Ll];.*/))))","rule_id":"a9b6c011-ab69-4ddb-bc0a-c4f21c80ec47","timestamp_override":"event.ingested","references":["https://support.microsoft.com/en-us/topic/information-about-the-attachment-manager-in-microsoft-windows-c48a4dcd-8de5-2af5-ee9b-cd795ae42738","https://www.virustotal.com/gui/file/2bcd5702a7565952c44075ac6fb946c7780526640d1264f692c7664c02c68465"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((winlog.event_data.EventType:SetValue AND registry.path:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Associations\\\\*) AND ((registry.path:*\\\\DefaultFileTypeRisk AND winlog.event_data.Details:DWORD\\ \\(0x00006152\\)) OR (registry.path:*\\\\LowRiskFileTypes AND winlog.event_data.Details:(*.zip;* OR *.rar;* OR *.exe;* OR *.bat;* OR *.com;* OR *.cmd;* OR *.reg;* OR *.msi;* OR *.htm;* OR *.html;*))))`"}
