{"id":"7b4f794b-590a-4ad4-ba18-7964a2832205","created_by":"elhoim","name":"Renamed or Portable Vmnat.exe","tags":["attack.defense_evasion","attack.t1574.002"],"interval":"5m","description":"Detects renamed vmnat.exe or portable version that can be used for DLL side-loading","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.pe.original_file_name:/[Vv][Mm][Nn][Aa][Tt]\\.[Ee][Xx][Ee]/ AND (NOT ((process.executable:/.*[Vv][Mm][Nn][Aa][Tt]\\.[Ee][Xx][Ee]/) OR (process.executable:(/[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\[Vv][Mm][Ww][Aa][Rr][Ee]\\\\[Vv][Mm][Ww][Aa][Rr][Ee]\\ [Ww][Oo][Rr][Kk][Ss][Tt][Aa][Tt][Ii][Oo][Nn]\\\\[Vv][Mm][Nn][Aa][Tt]\\.[Ee][Xx][Ee]/ OR /[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Ww][Oo][Ww]64\\\\[Vv][Mm][Nn][Aa][Tt]\\.[Ee][Xx][Ee]/)))))","rule_id":"7b4f794b-590a-4ad4-ba18-7964a2832205","timestamp_override":"event.ingested","references":["https://twitter.com/malmoeb/status/1525901219247845376"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.pe.original_file_name:vmnat.exe AND (NOT ((process.executable:*vmnat.exe) OR (process.executable:(C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\VMware\\\\VMware\\ Workstation\\\\vmnat.exe OR C\\:\\\\Windows\\\\SysWOW64\\\\vmnat.exe)))))`"}
