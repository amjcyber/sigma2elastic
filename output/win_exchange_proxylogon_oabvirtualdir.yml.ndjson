{"id":"550d3350-bb8a-4ff3-9533-2ba533f4a1c0","created_by":"Florian Roth","name":"ProxyLogon MSExchange OabVirtualDirectory","tags":["attack.t1587.001","attack.resource_development"],"interval":"5m","description":"Detects specific patterns found after a successful ProxyLogon exploitation in relation to a Commandlet invocation of Set-OabVirtualDirectory","risk_score":99,"enabled":true,"severity":"critical","false_positives":["Unlikely"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(winlog.channel:MSExchange\\ Management AND \\*.keyword:(*OabVirtualDirectory* AND *\\ \\-ExternalUrl\\ *) AND \\*.keyword:(*eval\\(request* OR *http\\:\\/\\/f\\/<script* OR *\\\"unsafe\\\"\\};* OR *function\\ Page_Load\\(\\)*))","rule_id":"550d3350-bb8a-4ff3-9533-2ba533f4a1c0","timestamp_override":"event.ingested","references":["https://bi-zone.medium.com/hunting-down-ms-exchange-attacks-part-1-proxylogon-cve-2021-26855-26858-27065-26857-6e885c5f197c"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(winlog.channel:MSExchange\\ Management AND \\*.keyword:(*OabVirtualDirectory* AND *\\ \\-ExternalUrl\\ *) AND \\*.keyword:(*eval\\(request* OR *http\\:\\/\\/f\\/<script* OR *\\\"unsafe\\\"\\};* OR *function\\ Page_Load\\(\\)*))`"}
