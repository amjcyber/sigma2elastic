{"id":"5ee3a654-372f-11ec-8d3d-0242ac130003","created_by":"Orlinum , BlueDefenZer","name":"ADCS Certificate Template Configuration Vulnerability","tags":["attack.privilege_escalation","attack.credential_access"],"interval":"5m","description":"Detects certificate creation with template allowing risk permission subject","risk_score":21,"enabled":true,"severity":"low","false_positives":["Administrator activity","Proxy SSL certificate with subject modification","Smart card enrollement"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(winlog.channel:Security AND ((event.code:4898 AND TemplateContent:/.*[Cc][Tt]_[Ff][Ll][Aa][Gg]_[Ee][Nn][Rr][Oo][Ll][Ll][Ee][Ee]_[Ss][Uu][Pp][Pp][Ll][Ii][Ee][Ss]_[Ss][Uu][Bb][Jj][Ee][Cc][Tt].*/) OR (event.code:4899 AND NewTemplateContent:/.*[Cc][Tt]_[Ff][Ll][Aa][Gg]_[Ee][Nn][Rr][Oo][Ll][Ll][Ee][Ee]_[Ss][Uu][Pp][Pp][Ll][Ii][Ee][Ss]_[Ss][Uu][Bb][Jj][Ee][Cc][Tt].*/)))","rule_id":"5ee3a654-372f-11ec-8d3d-0242ac130003","timestamp_override":"event.ingested","references":["https://www.specterops.io/assets/resources/Certified_Pre-Owned.pdf"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(winlog.channel:Security AND ((event.code:4898 AND TemplateContent:*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*) OR (event.code:4899 AND NewTemplateContent:*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*)))`"}
