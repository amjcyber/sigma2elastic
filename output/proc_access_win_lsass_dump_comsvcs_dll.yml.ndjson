{"id":"a49fa4d5-11db-418c-8473-1e014a8dd462","created_by":"Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","name":"Lsass Memory Dump via Comsvcs DLL","tags":["attack.credential_access","attack.t1003.001"],"interval":"5m","description":"Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass.","risk_score":99,"enabled":true,"severity":"critical","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(winlog.event_data.TargetImage:/.*\\\\[Ll][Ss][Aa][Ss][Ss]\\.[Ee][Xx][Ee]/ AND process.executable:/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Rr][Uu][Nn][Dd][Ll][Ll]32\\.[Ee][Xx][Ee]/ AND winlog.event_data.CallTrace:/.*[Cc][Oo][Mm][Ss][Vv][Cc][Ss]\\.[Dd][Ll][Ll].*/)","rule_id":"a49fa4d5-11db-418c-8473-1e014a8dd462","timestamp_override":"event.ingested","references":["https://twitter.com/shantanukhande/status/1229348874298388484","https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(winlog.event_data.TargetImage:*\\\\lsass.exe AND process.executable:C\\:\\\\Windows\\\\System32\\\\rundll32.exe AND winlog.event_data.CallTrace:*comsvcs.dll*)`"}
