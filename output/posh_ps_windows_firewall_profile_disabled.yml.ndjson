{"id":"488b44e7-3781-4a71-888d-c95abfacf44d","created_by":"Austin Songer @austinsonger","name":"Windows Firewall Profile Disabled","tags":["attack.defense_evasion","attack.t1562.004"],"interval":"5m","description":"Detects when a user disables the Windows Firewall via a Profile to help evade defense.","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(powershell.file.script_block_text:/.*[Ss][Ee][Tt]\\-[Nn][Ee][Tt][Ff][Ii][Rr][Ee][Ww][Aa][Ll][Ll][Pp][Rr][Oo][Ff][Ii][Ll][Ee].*/ AND powershell.file.script_block_text:/.*\\-[Pp][Rr][Oo][Ff][Ii][Ll][Ee].*/ AND powershell.file.script_block_text:/.*\\-[Ee][Nn][Aa][Bb][Ll][Ee][Dd].*/ AND powershell.file.script_block_text:/.*[Ff][Aa][Ll][Ss][Ee].*/)","rule_id":"488b44e7-3781-4a71-888d-c95abfacf44d","timestamp_override":"event.ingested","references":["https://docs.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewallprofile?view=windowsserver2019-ps","https://www.tutorialspoint.com/how-to-get-windows-firewall-profile-settings-using-powershell","http://powershellhelp.space/commands/set-netfirewallrule-psv5.php","http://woshub.com/manage-windows-firewall-powershell/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(powershell.file.script_block_text:*Set\\-NetFirewallProfile* AND powershell.file.script_block_text:*\\-Profile* AND powershell.file.script_block_text:*\\-Enabled* AND powershell.file.script_block_text:*False*)`"}
