{"id":"b6f91281-20aa-446a-b986-38a92813a18f","created_by":"frack113, Nasreddine Bencherchali","name":"DLL Search Order Hijackig Via Additional Space in Path","tags":["attack.persistence","attack.privilege_escalation","attack.defense_evasion","attack.t1574.002"],"interval":"5m","description":"Detects when an attacker create a similar folder structure to windows system folders such as (Windows, Program Files...)\nbut with a space in order to trick DLL load search order and perform a \"DLL Search Order Hijacking\" attack\n","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(file.path:(/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\ \\\\.*/ OR /[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\\\.*/ OR /[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\ \\\\.*/) AND file.path:/.*\\.[Dd][Ll][Ll]/)","rule_id":"b6f91281-20aa-446a-b986-38a92813a18f","timestamp_override":"event.ingested","references":["https://twitter.com/cyb3rops/status/1552932770464292864","https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(file.path:(C\\:\\\\Windows\\ \\\\* OR C\\:\\\\Program\\ Files\\ \\\\* OR C\\:\\\\Program\\ Files\\ \\(x86\\)\\ \\\\*) AND file.path:*.dll)`"}
