{"id":"41d40bff-377a-43e2-8e1b-2e543069e079","created_by":"Florian Roth (rule), Tom U. @c_APT_ure (collection), oscd.community, Jonhnathan Ribeiro","name":"WannaCry Ransomware","tags":["attack.lateral_movement","attack.t1210","attack.discovery","attack.t1083","attack.defense_evasion","attack.t1222.001","attack.impact","attack.t1486","attack.t1490"],"interval":"5m","description":"Detects WannaCry ransomware activity","risk_score":99,"enabled":true,"severity":"critical","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.executable:(/.*\\\\[Tt][Aa][Ss][Kk][Ss][Cc][Hh][Ee]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Mm][Ss][Ss][Ee][Cc][Ss][Vv][Cc]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Tt][Aa][Ss][Kk][Dd][Ll]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Tt][Aa][Ss][Kk][Hh][Ss][Vv][Cc]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Tt][Aa][Ss][Kk][Ss][Ee]\\.[Ee][Xx][Ee]/ OR /.*\\\\111\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ll][Hh][Dd][Ff][Rr][Gg][Uu][Ii]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ll][Ii][Nn][Uu][Xx][Nn][Ee][Ww]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ww][Aa][Nn][Nn][Aa][Cc][Rr][Yy]\\.[Ee][Xx][Ee]/) OR process.executable:/.*[Ww][Aa][Nn][Aa][Dd][Ee][Cc][Rr][Yy][Pp][Tt][Oo][Rr].*/ OR (process.command_line:/.*[Ii][Cc][Aa][Cc][Ll][Ss].*/ AND process.command_line:/.*\\/[Gg][Rr][Aa][Nn][Tt].*/ AND process.command_line:/.*[Ee][Vv][Ee][Rr][Yy][Oo][Nn][Ee]\\:[Ff].*/ AND process.command_line:/.*\\/[Tt].*/ AND process.command_line:/.*\\/[Cc].*/ AND process.command_line:/.*\\/[Qq].*/) OR (process.command_line:/.*[Bb][Cc][Dd][Ee][Dd][Ii][Tt].*/ AND process.command_line:/.*\\/[Ss][Ee][Tt].*/ AND process.command_line:/.*\\{[Dd][Ee][Ff][Aa][Uu][Ll][Tt]\\}.*/ AND process.command_line:/.*[Rr][Ee][Cc][Oo][Vv][Ee][Rr][Yy][Ee][Nn][Aa][Bb][Ll][Ee][Dd].*/ AND process.command_line:/.*[Nn][Oo].*/) OR (process.command_line:/.*[Ww][Bb][Aa][Dd][Mm][Ii][Nn].*/ AND process.command_line:/.*[Dd][Ee][Ll][Ee][Tt][Ee].*/ AND process.command_line:/.*[Cc][Aa][Tt][Aa][Ll][Oo][Gg].*/ AND process.command_line:/.*\\-[Qq][Uu][Ii][Ee][Tt].*/) OR process.command_line:/.*\\@[Pp][Ll][Ee][Aa][Ss][Ee]_[Rr][Ee][Aa][Dd]_[Mm][Ee]\\@\\.[Tt][Xx][Tt].*/)","rule_id":"41d40bff-377a-43e2-8e1b-2e543069e079","timestamp_override":"event.ingested","references":["https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.executable:(*\\\\tasksche.exe OR *\\\\mssecsvc.exe OR *\\\\taskdl.exe OR *\\\\taskhsvc.exe OR *\\\\taskse.exe OR *\\\\111.exe OR *\\\\lhdfrgui.exe OR *\\\\linuxnew.exe OR *\\\\wannacry.exe) OR process.executable:*WanaDecryptor* OR (process.command_line:*icacls* AND process.command_line:*\\/grant* AND process.command_line:*Everyone\\:F* AND process.command_line:*\\/T* AND process.command_line:*\\/C* AND process.command_line:*\\/Q*) OR (process.command_line:*bcdedit* AND process.command_line:*\\/set* AND process.command_line:*\\{default\\}* AND process.command_line:*recoveryenabled* AND process.command_line:*no*) OR (process.command_line:*wbadmin* AND process.command_line:*delete* AND process.command_line:*catalog* AND process.command_line:*\\-quiet*) OR process.command_line:*@Please_Read_Me@.txt*)`"}
