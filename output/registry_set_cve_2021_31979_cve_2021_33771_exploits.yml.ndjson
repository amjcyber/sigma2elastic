{"id":"32b5db62-cb5f-4266-9639-0fa48376ac00","created_by":"Sittikorn S, frack113","name":"CVE-2021-31979 CVE-2021-33771 Exploits","tags":["attack.credential_access","attack.t1566","attack.t1203","cve.2021.33771","cve.2021.31979"],"interval":"5m","description":"Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum","risk_score":99,"enabled":true,"severity":"critical","false_positives":["Unlikely"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((winlog.event_data.EventType:/[Ss][Ee][Tt][Vv][Aa][Ll][Uu][Ee]/ AND registry.path:(/.*[Cc][Ll][Ss][Ii][Dd]\\\\\\{[Cc][Ff]4[Cc][Cc]405\\-[Ee]2[Cc]5\\-4[Dd][Dd][Dd]\\-[Bb]3[Cc][Ee]\\-5[Ee]7582[Dd]8[Cc]9[Ff][Aa]\\}\\\\[Ii][Nn][Pp][Rr][Oo][Cc][Ss][Ee][Rr][Vv][Ee][Rr]32\\\\\\([Dd][Ee][Ff][Aa][Uu][Ll][Tt]\\)/ OR /.*[Cc][Ll][Ss][Ii][Dd]\\\\\\{7[Cc]857801\\-7381\\-11[Cc][Ff]\\-884[Dd]\\-00[Aa][Aa]004[Bb]2[Ee]24\\}\\\\[Ii][Nn][Pp][Rr][Oo][Cc][Ss][Ee][Rr][Vv][Ee][Rr]32\\\\\\([Dd][Ee][Ff][Aa][Uu][Ll][Tt]\\)/)) AND (NOT (winlog.event_data.Details:(/.*[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Ww][Bb][Ee][Mm]\\\\[Ww][Mm][Ii][Uu][Tt][Ii][Ll][Ss]\\.[Dd][Ll][Ll]/ OR /.*[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Ww][Bb][Ee][Mm]\\\\[Ww][Bb][Ee][Mm][Ss][Vv][Cc]\\.[Dd][Ll][Ll]/))))","rule_id":"32b5db62-cb5f-4266-9639-0fa48376ac00","timestamp_override":"event.ingested","references":["https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/","https://citizenlab.ca/2021/07/hooking-candiru-another-mercenary-spyware-vendor-comes-into-focus/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((winlog.event_data.EventType:SetValue AND registry.path:(*CLSID\\\\\\{CF4CC405\\-E2C5\\-4DDD\\-B3CE\\-5E7582D8C9FA\\}\\\\InprocServer32\\\\\\(Default\\) OR *CLSID\\\\\\{7C857801\\-7381\\-11CF\\-884D\\-00AA004B2E24\\}\\\\InProcServer32\\\\\\(Default\\))) AND (NOT (winlog.event_data.Details:(*system32\\\\wbem\\\\wmiutils.dll OR *system32\\\\wbem\\\\wbemsvc.dll))))`"}
