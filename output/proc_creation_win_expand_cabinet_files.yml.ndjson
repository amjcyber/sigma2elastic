{"id":"9f107a84-532c-41af-b005-8d12a607639f","created_by":"Bhabesh Raj","name":"Cabinet File Expansion","tags":["attack.execution","attack.t1218"],"interval":"5m","description":"Adversaries can use the inbuilt expand utility to decompress cab files as seen in recent Iranian MeteorExpress attack","risk_score":47,"enabled":true,"severity":"medium","false_positives":["System administrator Usage"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.executable:/.*\\\\[Ee][Xx][Pp][Aa][Nn][Dd]\\.[Ee][Xx][Ee]/ AND process.command_line:(/.*\\.[Cc][Aa][Bb].*/ OR /.*\\/[Ff]\\:.*/ OR /.*\\-[Ff]\\:.*/ OR /.*[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm][Dd][Aa][Tt][Aa]\\\\.*/ OR /.*[Cc]\\:\\\\[Pp][Uu][Bb][Ll][Ii][Cc]\\\\.*/ OR /.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Ll][Oo][Cc][Aa][Ll]\\\\[Tt][Ee][Mm][Pp]\\\\.*/ OR /.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Rr][Oo][Aa][Mm][Ii][Nn][Gg]\\\\[Tt][Ee][Mm][Pp]\\\\.*/))","rule_id":"9f107a84-532c-41af-b005-8d12a607639f","timestamp_override":"event.ingested","references":["https://labs.sentinelone.com/meteorexpress-mysterious-wiper-paralyzes-iranian-trains-with-epic-troll","https://blog.malwarebytes.com/threat-intelligence/2021/08/new-variant-of-konni-malware-used-in-campaign-targetting-russia/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.executable:*\\\\expand.exe AND process.command_line:(*.cab* OR *\\/F\\:* OR *\\-F\\:* OR *C\\:\\\\ProgramData\\\\* OR *C\\:\\\\Public\\\\* OR *\\\\AppData\\\\Local\\\\Temp\\\\* OR *\\\\AppData\\\\Roaming\\\\Temp\\\\*))`"}
