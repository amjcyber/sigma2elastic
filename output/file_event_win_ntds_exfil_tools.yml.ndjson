{"id":"3a8da4e0-36c1-40d2-8b29-b3e890d5172a","created_by":"Florian Roth","name":"Suspicious NTDS Exfil Filename Patterns","tags":["attack.credential_access","attack.t1003.003"],"interval":"5m","description":"Detects suspicious creations of files with names used in various tools that export the NTDS.DIT for exfiltration","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"file.path:(/.*\\\\[Aa][Ll][Ll]\\.[Cc][Aa][Bb]/ OR /.*\\.[Nn][Tt][Dd][Ss]\\.[Cc][Ll][Ee][Aa][Rr][Tt][Ee][Xx][Tt]/)","rule_id":"3a8da4e0-36c1-40d2-8b29-b3e890d5172a","timestamp_override":"event.ingested","references":["https://github.com/rapid7/metasploit-framework/blob/eb6535009f5fdafa954525687f09294918b5398d/modules/post/windows/gather/ntds_grabber.rb","https://github.com/rapid7/metasploit-framework/blob/eb6535009f5fdafa954525687f09294918b5398d/data/post/powershell/NTDSgrab.ps1","https://github.com/SecureAuthCorp/impacket/blob/7d2991d78836b376452ca58b3d14daa61b67cb40/impacket/examples/secretsdump.py#L2405"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`file.path:(*\\\\All.cab OR *.ntds.cleartext)`"}
