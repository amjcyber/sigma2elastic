{"id":"7124aebe-4cd7-4ccb-8df0-6d6b93c96795","created_by":"Florian Roth","name":"Suspicious Kernel Dump Using Dtrace","tags":null,"interval":"5m","description":"Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:/.*\\\\[Dd][Tt][Rr][Aa][Cc][Ee]\\.[Ee][Xx][Ee]/ AND process.command_line:/.*[Ll][Kk][Dd]\\(0\\).*/) OR (process.command_line:/.*[Ss][Yy][Ss][Cc][Aa][Ll][Ll]\\:\\:\\:[Rr][Ee][Tt][Uu][Rr][Nn].*/ AND process.command_line:/.*[Ll][Kk][Dd]\\(.*/))","rule_id":"7124aebe-4cd7-4ccb-8df0-6d6b93c96795","timestamp_override":"event.ingested","references":["https://twitter.com/0gtweet/status/1474899714290208777?s=12","https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/dtrace"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:*\\\\dtrace.exe AND process.command_line:*lkd\\(0\\)*) OR (process.command_line:*syscall\\:\\:\\:return* AND process.command_line:*lkd\\(*))`"}
