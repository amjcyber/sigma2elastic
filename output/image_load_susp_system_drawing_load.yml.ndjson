{"id":"666ecfc7-229d-42b8-821e-1a8f8cb7057c","created_by":"Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","name":"Suspicious System.Drawing Load","tags":["attack.collection","attack.t1113"],"interval":"5m","description":"A General detection for processes loading System.Drawing.ni.dll. This could be an indicator of potential Screen Capture.","risk_score":21,"enabled":true,"severity":"low","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(file.path:/.*\\\\[Ss][Yy][Ss][Tt][Ee][Mm]\\.[Dd][Rr][Aa][Ww][Ii][Nn][Gg]\\.[Nn][Ii]\\.[Dd][Ll][Ll]/ AND (NOT ((process.executable:(/[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\.*/ OR /[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\.*/ OR /[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\.*/ OR /[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\.[Nn][Ee][Tt]\\\\.*/ OR /[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ii][Mm][Mm][Ee][Rr][Ss][Ii][Vv][Ee][Cc][Oo][Nn][Tt][Rr][Oo][Ll][Pp][Aa][Nn][Ee][Ll]\\\\.*/)) OR (process.executable:/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Nn][Hh][Nn][Oo][Tt][Ii][Ff][Ss][Yy][Ss]\\.[Ee][Xx][Ee]/) OR (process.executable:/[Cc]\\:\\\\[Uu][Ss][Ee][Rr][Ss]\\\\.*/ AND process.executable:(/.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Ll][Oo][Cc][Aa][Ll]\\\\[Nn][Hh][Nn][Oo][Tt][Ii][Ff][Ss][Yy][Ss]\\\\[Nn][Aa][Hh][Ii][Mm][Ii][Cc]\\\\[Nn][Aa][Hh][Ii][Mm][Ii][Cc][Nn][Oo][Tt][Ii][Ff][Ss][Yy][Ss]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Gg][Ii][Tt][Hh][Uu][Bb][Dd][Ee][Ss][Kk][Tt][Oo][Pp]\\\\[Uu][Pp][Dd][Aa][Tt][Ee]\\.[Ee][Xx][Ee]/)))))","rule_id":"666ecfc7-229d-42b8-821e-1a8f8cb7057c","timestamp_override":"event.ingested","references":["https://github.com/OTRF/detection-hackathon-apt29/issues/16","https://threathunterplaybook.com/evals/apt29/detections/7.A.1_3B4E5808-3C71-406A-B181-17B0CE3178C9.html"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(file.path:*\\\\System.Drawing.ni.dll AND (NOT ((process.executable:(C\\:\\\\Program\\ Files\\\\* OR C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\* OR C\\:\\\\Windows\\\\System32\\\\* OR C\\:\\\\Windows\\\\Microsoft.NET\\\\* OR C\\:\\\\Windows\\\\ImmersiveControlPanel\\\\*)) OR (process.executable:C\\:\\\\Windows\\\\System32\\\\NhNotifSys.exe) OR (process.executable:C\\:\\\\Users\\\\* AND process.executable:(*\\\\AppData\\\\Local\\\\NhNotifSys\\\\nahimic\\\\nahimicNotifSys.exe OR *\\\\GitHubDesktop\\\\Update.exe)))))`"}
