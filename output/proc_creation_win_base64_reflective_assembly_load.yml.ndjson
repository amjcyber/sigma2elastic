{"id":"62b7ccc9-23b4-471e-aa15-6da3663c4d59","created_by":"Christian Burkard, pH-T","name":"Base64 Encoded Reflective Assembly Load","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1027"],"interval":"5m","description":"Detects base64 encoded .NET reflective loading of Assembly","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unlikely"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"process.command_line:(/.*[Ww][Ww][Bb][Ss][Aa][Gg][Uu][Aa][Zz][Gg][Bb][Ss][Aa][Gg][Uu][Aa][Yy][Ww][Bb]0[Aa][Gg][Kk][Aa][Bb][Ww][Bb][Uu][Aa][Cc]4[Aa][Qq][Qq][Bb][Zz][Aa][Hh][Mm][Aa][Zz][Qq][Bb][Tt][Aa][Gg][Ii][Aa][Bb][Aa][Bb]5[Aa][Ff]0[Aa][Oo][Gg][Aa]6[Aa][Ee][Ww][Aa][Bb][Ww][Bb][Hh][Aa][Gg][Qq][Aa][Kk][Aa].*/ OR /.*[Ss][Aa][Uu][Gg][Bb][Ll][Aa][Gg][Yy][Aa][Bb][Aa][Bb][Ll][Aa][Gg][Mm][Aa][Dd][Aa][Bb][Pp][Aa][Gg]8[Aa][Bb][Gg][Aa][Uu][Aa][Ee][Ee][Aa][Cc][Ww][Bb][Zz][Aa][Gg][Uu][Aa][Bb][Qq][Bb][Ii][Aa][Gg][Ww][Aa][Ee][Qq][Bb][Dd][Aa][Dd][Oo][Aa][Oo][Gg][Bb][Mm][Aa][Gg]8[Aa][Yy][Qq][Bb][Kk][Aa][Cc][Gg][Aa].*/ OR /.*[Bb][Aa][Ff][Ii][Aa][Zz][Qq][Bb][Mm][Aa][Gg][Ww][Aa][Zz][Qq][Bb][Jj][Aa][Hh][Qq][Aa][Aa][Qq][Bb][Vv][Aa][Gg]4[Aa][Ll][Gg][Bb][Bb][Aa][Hh][Mm][Aa][Cc][Ww][Bb][Ll][Aa][Gg]0[Aa][Yy][Gg][Bb][Ss][Aa][Hh][Kk][Aa][Xx][Qq][Aa]6[Aa][Dd][Oo][Aa][Tt][Aa][Bb][Vv][Aa][Gg][Ee][Aa][Zz][Aa][Aa][Oo][Aa].*/ OR /.*[Aa][Ff][Ss][Aa][Cc][Gg][Bb][Ll][Aa][Gg][Yy][Aa][Bb][Aa][Bb][Ll][Aa][Gg][Mm][Aa][Dd][Aa][Bb][Pp][Aa][Gg]8[Aa][Bb][Gg][Aa][Uu][Aa][Gg][Ee][Aa][Cc][Ww][Bb][Zz][Aa][Gg][Uu][Aa][Bb][Qq][Bb][Ii][Aa][Gg][Ww][Aa][Ee][Qq][Bb][Dd][Aa][Dd][Oo][Aa][Oo][Gg][Aa][Oo][Aa][Cc][Ii][Aa][Tt][Aa][Bb][Vv][Aa][Gg][Ee][Aa][Zz][Aa][Aa][Ii][Aa][Cc].*/ OR /.*[Bb][Bb][Aa][Hh][Ii][Aa][Zz][Qq][Bb][Mm][Aa][Gg][Ww][Aa][Zz][Qq][Bb][Jj][Aa][Hh][Qq][Aa][Aa][Qq][Bb][Vv][Aa][Gg]4[Aa][Ll][Gg][Bb][Hh][Aa][Hh][Mm][Aa][Cc][Ww][Bb][Ll][Aa][Gg]0[Aa][Yy][Gg][Bb][Ss][Aa][Hh][Kk][Aa][Xx][Qq][Aa]6[Aa][Dd][Oo][Aa][Kk][Aa][Aa][Ii][Aa][Ee][Ww][Aa][Bb][Ww][Bb][Hh][Aa][Gg][Qq][Aa][Ii][Gg][Aa][Pp].*/ OR /.*[Aa][Ww][Ww][Bb][Yy][Aa][Gg][Uu][Aa][Zz][Gg][Bb][Ss][Aa][Gg][Uu][Aa][Yy][Ww][Bb]0[Aa][Gg][Kk][Aa][Bb][Ww][Bb][Uu][Aa][Cc]4[Aa][Yy][Qq][Bb][Zz][Aa][Hh][Mm][Aa][Zz][Qq][Bb][Tt][Aa][Gg][Ii][Aa][Bb][Aa][Bb]5[Aa][Ff]0[Aa][Oo][Gg][Aa]6[Aa][Cc][Gg][Aa][Ii][Gg][Bb][Mm][Aa][Gg]8[Aa][Yy][Qq][Bb][Kk][Aa][Cc][Ii][Aa][Kk].*/ OR /.*[Ww][Ww][Bb][Ss][Aa][Gg][Uu][Aa][Zz][Gg][Bb][Ss][Aa][Gg][Uu][Aa][Yy][Ww][Bb]0[Aa][Gg][Kk][Aa][Bb][Ww][Bb][Uu][Aa][Cc]4[Aa][Qq][Qq][Bb][Zz][Aa][Hh][Mm][Aa][Zz][Qq][Bb][Tt][Aa][Gg][Ii][Aa][Bb][Aa][Bb]5[Aa][Ff]0[Aa][Oo][Gg][Aa]6[Aa][Cc][Gg][Aa][Ii][Gg][Bb][Mm][Aa][Gg]8[Aa][Yy][Qq][Bb][Kk][Aa][Cc][Ii][Aa][Kk][Qq].*/ OR /.*[Ss][Aa][Uu][Gg][Bb][Ll][Aa][Gg][Yy][Aa][Bb][Aa][Bb][Ll][Aa][Gg][Mm][Aa][Dd][Aa][Bb][Pp][Aa][Gg]8[Aa][Bb][Gg][Aa][Uu][Aa][Ee][Ee][Aa][Cc][Ww][Bb][Zz][Aa][Gg][Uu][Aa][Bb][Qq][Bb][Ii][Aa][Gg][Ww][Aa][Ee][Qq][Bb][Dd][Aa][Dd][Oo][Aa][Oo][Gg][Aa][Oo][Aa][Cc][Ii][Aa][Tt][Aa][Bb][Vv][Aa][Gg][Ee][Aa][Zz][Aa][Aa][Ii][Aa][Cc][Kk][Aa].*/ OR /.*[Bb][Aa][Ff][Ii][Aa][Zz][Qq][Bb][Mm][Aa][Gg][Ww][Aa][Zz][Qq][Bb][Jj][Aa][Hh][Qq][Aa][Aa][Qq][Bb][Vv][Aa][Gg]4[Aa][Ll][Gg][Bb][Bb][Aa][Hh][Mm][Aa][Cc][Ww][Bb][Ll][Aa][Gg]0[Aa][Yy][Gg][Bb][Ss][Aa][Hh][Kk][Aa][Xx][Qq][Aa]6[Aa][Dd][Oo][Aa][Kk][Aa][Aa][Ii][Aa][Ee][Ww][Aa][Bb][Ww][Bb][Hh][Aa][Gg][Qq][Aa][Ii][Gg][Aa][Pp][Aa].*/ OR /.*[Ww][Ww][Bb][Yy][Aa][Gg][Uu][Aa][Zz][Gg][Bb][Ss][Aa][Gg][Uu][Aa][Yy][Ww][Bb]0[Aa][Gg][Kk][Aa][Bb][Ww][Bb][Uu][Aa][Cc]4[Aa][Yy][Qq][Bb][Zz][Aa][Hh][Mm][Aa][Zz][Qq][Bb][Tt][Aa][Gg][Ii][Aa][Bb][Aa][Bb]5[Aa][Ff]0[Aa][Oo][Gg][Aa]6[Aa][Ee][Ww][Aa][Bb][Ww][Bb][Hh][Aa][Gg][Qq][Aa][Kk][Aa].*/ OR /.*[Ss][Aa][Cc][Gg][Bb][Ll][Aa][Gg][Yy][Aa][Bb][Aa][Bb][Ll][Aa][Gg][Mm][Aa][Dd][Aa][Bb][Pp][Aa][Gg]8[Aa][Bb][Gg][Aa][Uu][Aa][Gg][Ee][Aa][Cc][Ww][Bb][Zz][Aa][Gg][Uu][Aa][Bb][Qq][Bb][Ii][Aa][Gg][Ww][Aa][Ee][Qq][Bb][Dd][Aa][Dd][Oo][Aa][Oo][Gg][Bb][Mm][Aa][Gg]8[Aa][Yy][Qq][Bb][Kk][Aa][Cc][Gg][Aa].*/ OR /.*[Bb][Aa][Hh][Ii][Aa][Zz][Qq][Bb][Mm][Aa][Gg][Ww][Aa][Zz][Qq][Bb][Jj][Aa][Hh][Qq][Aa][Aa][Qq][Bb][Vv][Aa][Gg]4[Aa][Ll][Gg][Bb][Hh][Aa][Hh][Mm][Aa][Cc][Ww][Bb][Ll][Aa][Gg]0[Aa][Yy][Gg][Bb][Ss][Aa][Hh][Kk][Aa][Xx][Qq][Aa]6[Aa][Dd][Oo][Aa][Tt][Aa][Bb][Vv][Aa][Gg][Ee][Aa][Zz][Aa][Aa][Oo][Aa].*/)","rule_id":"62b7ccc9-23b4-471e-aa15-6da3663c4d59","timestamp_override":"event.ingested","references":["https://github.com/Neo23x0/Raccine/blob/20a569fa21625086433dcce8bb2765d0ea08dcb6/yara/mal_revil.yar","https://thedfirreport.com/2022/05/09/seo-poisoning-a-gootloader-story/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`process.command_line:(*WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA* OR *sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA* OR *bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA* OR *AFsAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiAC* OR *BbAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgAp* OR *AWwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAK* OR *WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAKQ* OR *sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiACkA* OR *bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgApA* OR *WwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA* OR *sAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA* OR *bAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA*)`"}
