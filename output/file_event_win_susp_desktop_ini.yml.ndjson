{"id":"81315b50-6b60-4d8f-9928-3466e1022515","created_by":"Maxime Thiebaut (@0xThiebaut), Tim Shelton (HAWK.IO)","name":"Suspicious desktop.ini Action","tags":["attack.persistence","attack.t1547.009"],"interval":"5m","description":"Detects unusual processes accessing desktop.ini, which can be leveraged to alter how Explorer displays a folder's content (i.e. renaming files) without changing them on disk.","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Operations performed through Windows SCCM or equivalent","Read only access list authority"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(file.path:/.*\\\\[Dd][Ee][Ss][Kk][Tt][Oo][Pp]\\.[Ii][Nn][Ii]/ AND (NOT (process.executable:(/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\.*/ OR /[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\.*/ OR /[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\.*/))))","rule_id":"81315b50-6b60-4d8f-9928-3466e1022515","timestamp_override":"event.ingested","references":["https://isc.sans.edu/forums/diary/Desktopini+as+a+postexploitation+tool/25912/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(file.path:*\\\\desktop.ini AND (NOT (process.executable:(C\\:\\\\Windows\\\\* OR C\\:\\\\Program\\ Files\\\\* OR C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\*))))`"}
