{"id":"4fcac6eb-0287-4090-8eea-2602e4c20040","created_by":"Florian Roth","name":"QBot Process Creation","tags":["attack.execution","attack.t1059.005"],"interval":"5m","description":"Detects QBot like process executions","risk_score":99,"enabled":true,"severity":"critical","false_positives":["Unlikely"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.parent.executable:/.*\\\\[Ww][Ii][Nn][Rr][Aa][Rr]\\.[Ee][Xx][Ee]/ AND process.executable:/.*\\\\[Ww][Ss][Cc][Rr][Ii][Pp][Tt]\\.[Ee][Xx][Ee]/) OR process.command_line:/.*\\ \\/[Cc]\\ [Pp][Ii][Nn][Gg]\\.[Ee][Xx][Ee]\\ \\-[Nn]\\ 6\\ 127\\.0\\.0\\.1\\ \\&\\ [Tt][Yy][Pp][Ee]\\ .*/ OR (process.command_line:/.*[Rr][Ee][Gg][Ss][Vv][Rr]32\\.[Ee][Xx][Ee].*/ AND process.command_line:/.*[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm][Dd][Aa][Tt][Aa].*/ AND process.command_line:/.*\\.[Tt][Mm][Pp].*/))","rule_id":"4fcac6eb-0287-4090-8eea-2602e4c20040","timestamp_override":"event.ingested","references":["https://twitter.com/killamjr/status/1179034907932315648","https://app.any.run/tasks/2e0647b7-eb86-4f72-904b-d2d0ecac07d1/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.parent.executable:*\\\\WinRAR.exe AND process.executable:*\\\\wscript.exe) OR process.command_line:*\\ \\/c\\ ping.exe\\ \\-n\\ 6\\ 127.0.0.1\\ &\\ type\\ * OR (process.command_line:*regsvr32.exe* AND process.command_line:*C\\:\\\\ProgramData* AND process.command_line:*.tmp*))`"}
