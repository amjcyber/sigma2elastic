{"id":"d3bf399f-b0cf-4250-8bb4-dfc192ab81dc","created_by":"frack113","name":"Ie4uinit Lolbin Use From Invalid Path","tags":["attack.defense_evasion","attack.t1218"],"interval":"5m","description":"Detect use of ie4uinit.exe to execute commands from a specially prepared ie4uinit.inf file from a directory other than the usual directories","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:/.*\\\\[Ii][Ee]4[Uu][Ii][Nn][Ii][Tt]\\.[Ee][Xx][Ee]/ OR process.pe.original_file_name:/[Ii][Ee]4[Uu][Ii][Nn][Ii][Tt]\\.[Ee][Xx][Ee]/) AND (NOT ((process.working_directory:(/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\/ OR /[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Ww][Oo][Ww]64\\\\/)) OR (NOT _exists_:process.working_directory))))","rule_id":"d3bf399f-b0cf-4250-8bb4-dfc192ab81dc","timestamp_override":"event.ingested","references":["https://lolbas-project.github.io/lolbas/Binaries/Ie4uinit/","https://bohops.com/2018/03/10/leveraging-inf-sct-fetch-execute-techniques-for-bypass-evasion-persistence-part-2/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:*\\\\ie4uinit.exe OR process.pe.original_file_name:IE4UINIT.EXE) AND (NOT ((process.working_directory:(c\\:\\\\windows\\\\system32\\\\ OR c\\:\\\\windows\\\\sysWOW64\\\\)) OR (NOT _exists_:process.working_directory))))`"}
