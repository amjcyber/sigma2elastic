{"id":"737e618a-a410-49b5-bec3-9e55ff7fbc15","created_by":"Florian Roth","name":"Suspicious Calculator Usage","tags":["attack.defense_evasion","attack.t1036"],"interval":"5m","description":"Detects suspicious use of 'calc.exe' with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.command_line:/.*\\\\[Cc][Aa][Ll][Cc]\\.[Ee][Xx][Ee]\\ .*/ OR process.executable:/.*\\\\[Cc][Aa][Ll][Cc]\\.[Ee][Xx][Ee]/) AND (NOT (process.executable:(/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\.*/ OR /[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Ww][Oo][Ww]64\\\\.*/ OR /[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ww][Ii][Nn][Ss][Xx][Ss]\\\\.*/))))","rule_id":"737e618a-a410-49b5-bec3-9e55ff7fbc15","timestamp_override":"event.ingested","references":["https://twitter.com/ItsReallyNick/status/1094080242686312448"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.command_line:*\\\\calc.exe\\ * OR process.executable:*\\\\calc.exe) AND (NOT (process.executable:(C\\:\\\\Windows\\\\System32\\\\* OR C\\:\\\\Windows\\\\SysWOW64\\\\* OR C\\:\\\\Windows\\\\WinSxS\\\\*))))`"}
