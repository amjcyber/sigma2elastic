{"id":"f9df325d-d7bc-4a32-8a1a-2cc61dcefc63","created_by":"Nasreddine Bencherchali, Wietze Beukema (project and research)","name":"Third Party Software DLL Sideloading","tags":["attack.defense_evasion","attack.persistence","attack.privilege_escalation","attack.t1574.001","attack.t1574.002"],"interval":"5m","description":"Detects DLL sideloading of DLLs that are part of third party software (zoom, discord....etc)","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((file.path:/.*\\\\[Cc][Oo][Mm][Mm][Ff][Uu][Nn][Cc]\\.[Dd][Ll][Ll]/ AND (NOT (file.path:/.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Ll][Oo][Cc][Aa][Ll]\\\\[Gg][Oo][Oo][Gg][Ll][Ee]\\\\[Cc][Hh][Rr][Oo][Mm][Ee]\\\\[Aa][Pp][Pp][Ll][Ii][Cc][Aa][Tt][Ii][Oo][Nn]\\\\.*/ OR file.path:(/[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Ll][Ee][Nn][Oo][Vv][Oo]\\\\[Cc][Oo][Mm][Mm][Uu][Nn][Ii][Cc][Aa][Tt][Ii][Oo][Nn][Ss]\\ [Uu][Tt][Ii][Ll][Ii][Tt][Yy]\\\\.*/ OR /[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\[Ll][Ee][Nn][Oo][Vv][Oo]\\\\[Cc][Oo][Mm][Mm][Uu][Nn][Ii][Cc][Aa][Tt][Ii][Oo][Nn][Ss]\\ [Uu][Tt][Ii][Ll][Ii][Tt][Yy]\\\\.*/)))) OR (file.path:/.*\\\\[Tt][Oo][Ss][Bb][Tt][Kk][Bb][Dd]\\.[Dd][Ll][Ll]/ AND (NOT (file.path:(/[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Tt][Oo][Ss][Hh][Ii][Bb][Aa]\\\\[Bb][Ll][Uu][Ee][Tt][Oo][Oo][Tt][Hh]\\ [Tt][Oo][Ss][Hh][Ii][Bb][Aa]\\ [Ss][Tt][Aa][Cc][Kk]\\\\.*/ OR /[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\[Tt][Oo][Ss][Hh][Ii][Bb][Aa]\\\\[Bb][Ll][Uu][Ee][Tt][Oo][Oo][Tt][Hh]\\ [Tt][Oo][Ss][Hh][Ii][Bb][Aa]\\ [Ss][Tt][Aa][Cc][Kk]\\\\.*/)))))","rule_id":"f9df325d-d7bc-4a32-8a1a-2cc61dcefc63","timestamp_override":"event.ingested","references":["https://hijacklibs.net/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((file.path:*\\\\commfunc.dll AND (NOT (file.path:*\\\\AppData\\\\local\\\\Google\\\\Chrome\\\\Application\\\\* OR file.path:(C\\:\\\\Program\\ Files\\\\Lenovo\\\\Communications\\ Utility\\\\* OR C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Lenovo\\\\Communications\\ Utility\\\\*)))) OR (file.path:*\\\\tosbtkbd.dll AND (NOT (file.path:(C\\:\\\\Program\\ Files\\\\Toshiba\\\\Bluetooth\\ Toshiba\\ Stack\\\\* OR C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Toshiba\\\\Bluetooth\\ Toshiba\\ Stack\\\\*)))))`"}
