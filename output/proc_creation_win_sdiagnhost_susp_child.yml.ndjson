{"id":"f3d39c45-de1a-4486-a687-ab126124f744","created_by":"Nextron Systems","name":"Sdiagnhost Calling Suspicious Child Process","tags":["attack.defense_evasion","attack.t1036","attack.t1218"],"interval":"5m","description":"Detects sdiagnhost.exe calling a suspicious child process (e.g. used in exploits for Follina / CVE-2022-30190)","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.parent.executable:/.*\\\\[Ss][Dd][Ii][Aa][Gg][Nn][Hh][Oo][Ss][Tt]\\.[Ee][Xx][Ee]/ AND process.executable:(/.*\\\\[Pp][Oo][Ww][Ee][Rr][Ss][Hh][Ee][Ll][Ll]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Ww][Ss][Hh]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Cc][Mm][Dd]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Mm][Ss][Hh][Tt][Aa]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Cc][Ss][Cc][Rr][Ii][Pp][Tt]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ww][Ss][Cc][Rr][Ii][Pp][Tt]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Tt][Aa][Ss][Kk][Kk][Ii][Ll][Ll]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Cc][Aa][Ll][Cc]\\.[Ee][Xx][Ee]/))","rule_id":"f3d39c45-de1a-4486-a687-ab126124f744","timestamp_override":"event.ingested","references":["https://twitter.com/nao_sec/status/1530196847679401984","https://app.any.run/tasks/713f05d2-fe78-4b9d-a744-f7c133e3fafb/","https://app.any.run/tasks/f420d295-0457-4e9b-9b9e-6732be227583/","https://app.any.run/tasks/c4117d9a-f463-461a-b90f-4cd258746798/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.parent.executable:*\\\\sdiagnhost.exe AND process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe OR *\\\\cmd.exe OR *\\\\mshta.exe OR *\\\\cscript.exe OR *\\\\wscript.exe OR *\\\\taskkill.exe OR *\\\\calc.exe))`"}
