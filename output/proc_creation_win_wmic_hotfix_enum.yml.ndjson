{"id":"dfd2fcb7-8bd5-4daa-b132-5adb61d6ad45","created_by":"Nasreddine Bencherchali","name":"WMIC Hotfix Recon","tags":["attack.execution","attack.t1047"],"interval":"5m","description":"Detects wmic known recon method to look for installed hotfixes, often used by pentest and attackers enum scripts","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.pe.original_file_name:/[Ww][Mm][Ii][Cc]\\.[Ee][Xx][Ee]/ OR process.executable:/.*\\\\[Ww][Mm][Ii][Cc]\\.[Ee][Xx][Ee]/) AND (process.command_line:/.*\\ [Qq][Ff][Ee]\\ .*/ AND process.command_line:/.*\\ [Gg][Ee][Tt]\\ .*/ AND process.command_line:/.*[Cc][Aa][Pp][Tt][Ii][Oo][Nn],[Dd][Ee][Ss][Cc][Rr][Ii][Pp][Tt][Ii][Oo][Nn],[Hh][Oo][Tt][Ff][Ii][Xx][Ii][Dd],[Ii][Nn][Ss][Tt][Aa][Ll][Ll][Ee][Dd][Oo][Nn].*/))","rule_id":"dfd2fcb7-8bd5-4daa-b132-5adb61d6ad45","timestamp_override":"event.ingested","references":["https://github.com/carlospolop/PEASS-ng/blob/fa0f2e17fbc1d86f1fd66338a40e665e7182501d/winPEAS/winPEASbat/winPEAS.bat","https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.pe.original_file_name:wmic.exe OR process.executable:*\\\\WMIC.exe) AND (process.command_line:*\\ qfe\\ * AND process.command_line:*\\ get\\ * AND process.command_line:*Caption,Description,HotFixID,InstalledOn*))`"}
