{"id":"b5281f31-f9cc-4d0d-95d0-45b91c45b487","created_by":"Florian Roth","name":"DNS RCE CVE-2020-1350","tags":["attack.initial_access","attack.t1190","attack.execution","attack.t1569.002"],"interval":"5m","description":"Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process","risk_score":99,"enabled":true,"severity":"critical","false_positives":["Unknown but benign sub processes of the Windows DNS service dns.exe"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.parent.executable:/.*\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Dd][Nn][Ss]\\.[Ee][Xx][Ee]/ AND (NOT (process.executable:(/.*\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Ww][Ee][Rr][Ff][Aa][Uu][Ll][Tt]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Cc][Oo][Nn][Hh][Oo][Ss][Tt]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Dd][Nn][Ss][Cc][Mm][Dd]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Dd][Nn][Ss]\\.[Ee][Xx][Ee]/))))","rule_id":"b5281f31-f9cc-4d0d-95d0-45b91c45b487","timestamp_override":"event.ingested","references":["https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/","https://blog.menasec.net/2019/02/threat-hunting-24-microsoft-windows-dns.html"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.parent.executable:*\\\\System32\\\\dns.exe AND (NOT (process.executable:(*\\\\System32\\\\werfault.exe OR *\\\\System32\\\\conhost.exe OR *\\\\System32\\\\dnscmd.exe OR *\\\\System32\\\\dns.exe))))`"}
