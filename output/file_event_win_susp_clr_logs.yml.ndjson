{"id":"e4b63079-6198-405c-abd7-3fe8b0ce3263","created_by":"omkar72, oscd.community, Wojciech Lesicki","name":"Suspicious CLR Logs Creation","tags":["attack.execution","attack.defense_evasion","attack.t1059.001","attack.t1218"],"interval":"5m","description":"Detects suspicious .NET assembly executions. Could detect using Cobalt Strike's command execute-assembly.","risk_score":73,"enabled":true,"severity":"high","false_positives":["Rundll32.exe with zzzzInvokeManagedCustomActionOutOfProc in command line and msiexec.exe as parent process - https://twitter.com/SBousseaden/status/1388064061087260675"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(file.path:/.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Ll][Oo][Cc][Aa][Ll]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\[Cc][Ll][Rr].*/ AND file.path:/.*\\\\[Uu][Ss][Aa][Gg][Ee][Ll][Oo][Gg][Ss]\\\\.*/ AND file.path:(/.*[Mm][Ss][Hh][Tt][Aa].*/ OR /.*[Cc][Ss][Cc][Rr][Ii][Pp][Tt].*/ OR /.*[Ww][Ss][Cc][Rr][Ii][Pp][Tt].*/ OR /.*[Rr][Ee][Gg][Ss][Vv][Rr]32.*/ OR /.*[Ww][Mm][Ii][Cc].*/ OR /.*[Rr][Uu][Nn][Dd][Ll][Ll]32.*/ OR /.*[Ss][Vv][Cc][Hh][Oo][Ss][Tt].*/))","rule_id":"e4b63079-6198-405c-abd7-3fe8b0ce3263","timestamp_override":"event.ingested","references":["https://blog.menasec.net/2019/07/interesting-difr-traces-of-net-clr.html","https://bohops.com/2021/03/16/investigating-net-clr-usage-log-tampering-techniques-for-edr-evasion/","https://github.com/olafhartong/sysmon-modular/blob/5e5f6d90819a7f35eec0aba08021d0d201bb9055/11_file_create/include_dotnet.xml"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(file.path:*\\\\AppData\\\\Local\\\\Microsoft\\\\CLR* AND file.path:*\\\\UsageLogs\\\\* AND file.path:(*mshta* OR *cscript* OR *wscript* OR *regsvr32* OR *wmic* OR *rundll32* OR *svchost*))`"}
