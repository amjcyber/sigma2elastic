{"id":"73bba97f-a82d-42ce-b315-9182e76c57b1","created_by":"Oddvar Moe, Sander Wiebing, oscd.community","name":"Imports Registry Key From a File","tags":["attack.t1112","attack.defense_evasion"],"interval":"5m","description":"Detects the import of the specified file to the registry with regedit.exe.","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Legitimate import of keys","Evernote"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:/.*\\\\[Rr][Ee][Gg][Ee][Dd][Ii][Tt]\\.[Ee][Xx][Ee]/ AND process.command_line:(/.*\\ \\/[Ii]\\ .*/ OR /.*\\ \\/[Ss]\\ .*/ OR /.*\\.[Rr][Ee][Gg].*/)) AND (NOT ((process.command_line:(/.*\\ \\/[Ee]\\ .*/ OR /.*\\ \\/[Aa]\\ .*/ OR /.*\\ \\/[Cc]\\ .*/ OR /.*\\ \\-[Ee]\\ .*/ OR /.*\\ \\-[Aa]\\ .*/ OR /.*\\ \\-[Cc]\\ .*/)) AND (process.command_line:/:[^ \\\\\\\\]/))))","rule_id":"73bba97f-a82d-42ce-b315-9182e76c57b1","timestamp_override":"event.ingested","references":["https://lolbas-project.github.io/lolbas/Binaries/Regedit/","https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:*\\\\regedit.exe AND process.command_line:(*\\ \\/i\\ * OR *\\ \\/s\\ * OR *.reg*)) AND (NOT ((process.command_line:(*\\ \\/e\\ * OR *\\ \\/a\\ * OR *\\ \\/c\\ * OR *\\ \\-e\\ * OR *\\ \\-a\\ * OR *\\ \\-c\\ *)) AND (process.command_line:/:[^ \\\\\\\\]/))))`"}
