{"id":"c7a74c80-ba5a-486e-9974-ab9e682bc5e4","created_by":"Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)","name":"Created Files by Office Applications","tags":["attack.t1204.002","attack.execution"],"interval":"5m","description":"This rule will monitor executable and script file creation by office applications. Please add more file extensions or magic bytes to the logic of your choice.","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:(/.*\\\\[Ww][Ii][Nn][Ww][Oo][Rr][Dd]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Ee][Xx][Cc][Ee][Ll]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Oo][Ww][Ee][Rr][Pp][Nn][Tt]\\.[Ee][Xx][Ee]/) AND file.path:(/.*\\.[Ee][Xx][Ee]/ OR /.*\\.[Dd][Ll][Ll]/ OR /.*\\.[Oo][Cc][Xx]/ OR /.*\\.[Cc][Oo][Mm]/ OR /.*\\.[Pp][Ss]1/ OR /.*\\.[Vv][Bb][Ss]/ OR /.*\\.[Ss][Yy][Ss]/ OR /.*\\.[Bb][Aa][Tt]/ OR /.*\\.[Ss][Cc][Rr]/ OR /.*\\.[Pp][Rr][Oo][Jj]/)) AND (NOT ((file.path:/.*[Cc]\\:\\\\[Uu][Ss][Ee][Rr][Ss]\\\\.*/ AND file.path:/.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Ll][Oo][Cc][Aa][Ll]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\[Oo][Ff][Ff][Ii][Cc][Ee]\\\\.*/ AND file.path:/.*\\\\[Ww][Ee][Bb][Ss][Ee][Rr][Vv][Ii][Cc][Ee][Cc][Aa][Cc][Hh][Ee]\\\\[Aa][Ll][Ll][Uu][Ss][Ee][Rr][Ss].*/ AND file.path:/.*\\.[Cc][Oo][Mm]/) OR (process.executable:/.*\\\\[Ww][Ii][Nn][Ww][Oo][Rr][Dd]\\.[Ee][Xx][Ee]/ AND file.path:/.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Ll][Oo][Cc][Aa][Ll]\\\\[Tt][Ee][Mm][Pp]\\\\[Ww][Ee][Bb][Ee][Xx][Dd][Ee][Ll][Tt][Aa]\\\\.*/ AND file.path:(/.*\\.[Dd][Ll][Ll]/ OR /.*\\.[Ee][Xx][Ee]/)) OR (file.path:/.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Ll][Oo][Cc][Aa][Ll]\\\\[Aa][Ss][Ss][Ee][Mm][Bb][Ll][Yy]\\\\[Tt][Mm][Pp]\\\\.*/ AND file.path:/.*\\.[Dd][Ll][Ll]/))))","rule_id":"c7a74c80-ba5a-486e-9974-ab9e682bc5e4","timestamp_override":"event.ingested","references":["https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/","https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:(*\\\\winword.exe OR *\\\\excel.exe OR *\\\\powerpnt.exe) AND file.path:(*.exe OR *.dll OR *.ocx OR *.com OR *.ps1 OR *.vbs OR *.sys OR *.bat OR *.scr OR *.proj)) AND (NOT ((file.path:*C\\:\\\\Users\\\\* AND file.path:*\\\\AppData\\\\Local\\\\Microsoft\\\\Office\\\\* AND file.path:*\\\\WebServiceCache\\\\AllUsers* AND file.path:*.com) OR (process.executable:*\\\\winword.exe AND file.path:*\\\\AppData\\\\Local\\\\Temp\\\\webexdelta\\\\* AND file.path:(*.dll OR *.exe)) OR (file.path:*\\\\AppData\\\\Local\\\\assembly\\\\tmp\\\\* AND file.path:*.dll))))`"}
