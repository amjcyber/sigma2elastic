{"id":"258fc8ce-8352-443a-9120-8a11e4857fa5","created_by":"Nasreddine Bencherchali (rule)","name":"Execute Arbitrary Commands Using MSDT.EXE","tags":["attack.defense_evasion","attack.t1202"],"interval":"5m","description":"Detects processes leveraging the \"ms-msdt\" handler or the \"msdt.exe\" binary to execute arbitrary commands as seen in the follina (CVE-2022-30190) vulnerability","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.executable:/.*\\\\[Mm][Ss][Dd][Tt]\\.[Ee][Xx][Ee]/ OR process.pe.original_file_name:/[Mm][Ss][Dd][Tt]\\.[Ee][Xx][Ee]/) AND (process.command_line:/.*[Ii][Tt]_[Bb][Rr][Oo][Ww][Ss][Ee][Ff][Oo][Rr][Ff][Ii][Ll][Ee]\\=.*/ OR (process.command_line:/.*\\ [Pp][Cc][Ww][Dd][Ii][Aa][Gg][Nn][Oo][Ss][Tt][Ii][Cc].*/ AND process.command_line:(/.*\\ \\/[Aa][Ff]\\ .*/ OR /.*\\ \\-[Aa][Ff]\\ .*/))))","rule_id":"258fc8ce-8352-443a-9120-8a11e4857fa5","timestamp_override":"event.ingested","references":["https://twitter.com/nao_sec/status/1530196847679401984","https://app.any.run/tasks/713f05d2-fe78-4b9d-a744-f7c133e3fafb/","https://twitter.com/_JohnHammond/status/1531672601067675648"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.executable:*\\\\msdt.exe OR process.pe.original_file_name:msdt.exe) AND (process.command_line:*IT_BrowseForFile\\=* OR (process.command_line:*\\ PCWDiagnostic* AND process.command_line:(*\\ \\/af\\ * OR *\\ \\-af\\ *))))`"}
