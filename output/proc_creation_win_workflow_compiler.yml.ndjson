{"id":"419dbf2b-8a9b-4bea-bf99-7544b050ec8d","created_by":"Nik Seetharaman, frack113","name":"Microsoft Workflow Compiler","tags":["attack.defense_evasion","attack.execution","attack.t1127","attack.t1218"],"interval":"5m","description":"Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code.","risk_score":73,"enabled":true,"severity":"high","false_positives":["Legitimate MWC use (unlikely in modern enterprise environments)"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.executable:/.*\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\.[Ww][Oo][Rr][Kk][Ff][Ll][Oo][Ww]\\.[Cc][Oo][Mm][Pp][Ii][Ll][Ee][Rr]\\.[Ee][Xx][Ee]/ OR (process.pe.original_file_name:/[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\.[Ww][Oo][Rr][Kk][Ff][Ll][Oo][Ww]\\.[Cc][Oo][Mm][Pp][Ii][Ll][Ee][Rr]\\.[Ee][Xx][Ee]/ AND process.command_line:/.*\\.[Xx][Mm][Ll].*/))","rule_id":"419dbf2b-8a9b-4bea-bf99-7544b050ec8d","timestamp_override":"event.ingested","references":["https://posts.specterops.io/arbitrary-unsigned-code-execution-vector-in-microsoft-workflow-compiler-exe-3d9294bc5efb","https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218/T1218.md"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.executable:*\\\\Microsoft.Workflow.Compiler.exe OR (process.pe.original_file_name:Microsoft.Workflow.Compiler.exe AND process.command_line:*.xml*))`"}
