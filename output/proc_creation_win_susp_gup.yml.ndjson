{"id":"0a4f6091-223b-41f6-8743-f322ec84930b","created_by":"Florian Roth","name":"Suspicious GUP Usage","tags":["attack.defense_evasion","attack.t1574.002"],"interval":"5m","description":"Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks","risk_score":73,"enabled":true,"severity":"high","false_positives":["Execution of tools named GUP.exe and located in folders different than Notepad++\\updater"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.executable:/.*\\\\[Gg][Uu][Pp]\\.[Ee][Xx][Ee]/ AND (NOT ((process.executable:(/.*\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Nn][Oo][Tt][Ee][Pp][Aa][Dd]\\+\\+\\\\[Uu][Pp][Dd][Aa][Tt][Ee][Rr]\\\\[Gg][Uu][Pp]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\[Nn][Oo][Tt][Ee][Pp][Aa][Dd]\\+\\+\\\\[Uu][Pp][Dd][Aa][Tt][Ee][Rr]\\\\[Gg][Uu][Pp]\\.[Ee][Xx][Ee]/)) OR (process.executable:/.*\\\\[Uu][Ss][Ee][Rr][Ss]\\\\.*/ AND process.executable:(/.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Ll][Oo][Cc][Aa][Ll]\\\\[Nn][Oo][Tt][Ee][Pp][Aa][Dd]\\+\\+\\\\[Uu][Pp][Dd][Aa][Tt][Ee][Rr]\\\\[Gg][Uu][Pp]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Rr][Oo][Aa][Mm][Ii][Nn][Gg]\\\\[Nn][Oo][Tt][Ee][Pp][Aa][Dd]\\+\\+\\\\[Uu][Pp][Dd][Aa][Tt][Ee][Rr]\\\\[Gg][Uu][Pp]\\.[Ee][Xx][Ee]/)))))","rule_id":"0a4f6091-223b-41f6-8743-f322ec84930b","timestamp_override":"event.ingested","references":["https://www.fireeye.com/blog/threat-research/2018/09/apt10-targeting-japanese-corporations-using-updated-ttps.html"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.executable:*\\\\GUP.exe AND (NOT ((process.executable:(*\\\\Program\\ Files\\\\Notepad\\+\\+\\\\updater\\\\GUP.exe OR *\\\\Program\\ Files\\ \\(x86\\)\\\\Notepad\\+\\+\\\\updater\\\\GUP.exe)) OR (process.executable:*\\\\Users\\\\* AND process.executable:(*\\\\AppData\\\\Local\\\\Notepad\\+\\+\\\\updater\\\\GUP.exe OR *\\\\AppData\\\\Roaming\\\\Notepad\\+\\+\\\\updater\\\\GUP.exe)))))`"}
