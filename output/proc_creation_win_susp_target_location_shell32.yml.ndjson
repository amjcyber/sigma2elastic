{"id":"32b96012-7892-429e-b26c-ac2bf46066ff","created_by":"Christian Burkard","name":"Shell32 DLL Execution in Suspicious Directory","tags":["attack.defense_evasion","attack.execution","attack.t1218.011"],"interval":"5m","description":"Detects shell32.dll executing a DLL in a suspicious directory","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.executable:/.*\\\\[Rr][Uu][Nn][Dd][Ll][Ll]32\\.[Ee][Xx][Ee]/ AND process.command_line:/.*[Ss][Hh][Ee][Ll][Ll]32\\.[Dd][Ll][Ll].*/ AND process.command_line:/.*[Cc][Oo][Nn][Tt][Rr][Oo][Ll]_[Rr][Uu][Nn][Dd][Ll][Ll].*/ AND process.command_line:(/.*%[Aa][Pp][Pp][Dd][Aa][Tt][Aa]%.*/ OR /.*%[Ll][Oo][Cc][Aa][Ll][Aa][Pp][Pp][Dd][Aa][Tt][Aa]%.*/ OR /.*%[Tt][Ee][Mm][Pp]%.*/ OR /.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\.*/ OR /.*\\\\[Tt][Ee][Mm][Pp]\\\\.*/ OR /.*\\\\[Uu][Ss][Ee][Rr][Ss]\\\\[Pp][Uu][Bb][Ll][Ii][Cc]\\\\.*/))","rule_id":"32b96012-7892-429e-b26c-ac2bf46066ff","timestamp_override":"event.ingested","references":["https://www.group-ib.com/resources/threat-research/red-curl-2.html"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.executable:*\\\\rundll32.exe AND process.command_line:*shell32.dll* AND process.command_line:*Control_RunDLL* AND process.command_line:(*%AppData%* OR *%LocalAppData%* OR *%Temp%* OR *\\\\AppData\\\\* OR *\\\\Temp\\\\* OR *\\\\Users\\\\Public\\\\*))`"}
