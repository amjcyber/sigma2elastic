{"id":"90dcf730-1b71-4ae7-9ffc-6fcf62bd0132","created_by":"frack113","name":"Suspicious ZipExec Execution","tags":["attack.execution","attack.defense_evasion","attack.t1218","attack.t1202"],"interval":"5m","description":"ZipExec is a Proof-of-Concept (POC) tool to wrap binary-based tools into a password-protected zip file.","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.command_line:/.*\\/[Gg][Ee][Nn][Ee][Rr][Ii][Cc]\\:[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]_[Ww][Ii][Nn][Dd][Oo][Ww][Ss]_[Ss][Hh][Ee][Ll][Ll]_[Zz][Ii][Pp][Ff][Oo][Ll][Dd][Ee][Rr]\\:[Ff][Ii][Ll][Ee][Nn][Aa][Mm][Ee]\\=.*/ AND process.command_line:/.*\\.[Zz][Ii][Pp].*/ AND process.command_line:/.*\\/[Pp][Aa][Ss][Ss]\\:.*/ AND process.command_line:/.*\\/[Uu][Ss][Ee][Rr]\\:.*/) OR (process.command_line:/.*\\/[Dd][Ee][Ll][Ee][Tt][Ee].*/ AND process.command_line:/.*[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]_[Ww][Ii][Nn][Dd][Oo][Ww][Ss]_[Ss][Hh][Ee][Ll][Ll]_[Zz][Ii][Pp][Ff][Oo][Ll][Dd][Ee][Rr]\\:[Ff][Ii][Ll][Ee][Nn][Aa][Mm][Ee]\\=.*/ AND process.command_line:/.*\\.[Zz][Ii][Pp].*/))","rule_id":"90dcf730-1b71-4ae7-9ffc-6fcf62bd0132","timestamp_override":"event.ingested","references":["https://twitter.com/SBousseaden/status/1451237393017839616","https://github.com/Tylous/ZipExec"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.command_line:*\\/generic\\:Microsoft_Windows_Shell_ZipFolder\\:filename\\=* AND process.command_line:*.zip* AND process.command_line:*\\/pass\\:* AND process.command_line:*\\/user\\:*) OR (process.command_line:*\\/delete* AND process.command_line:*Microsoft_Windows_Shell_ZipFolder\\:filename\\=* AND process.command_line:*.zip*))`"}
