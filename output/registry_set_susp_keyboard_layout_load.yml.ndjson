{"id":"34aa0252-6039-40ff-951f-939fd6ce47d8","created_by":"Florian Roth","name":"Suspicious Keyboard Layout Load","tags":["attack.resource_development","attack.t1588.002"],"interval":"5m","description":"Detects the keyboard preload installation with a suspicious keyboard layout, e.g. Chinese, Iranian or Vietnamese layout load in user session on systems maintained by US staff only","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Administrators or users that actually use the selected keyboard layouts (heavily depends on the organisation's user base)"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(winlog.event_data.EventType:/[Ss][Ee][Tt][Vv][Aa][Ll][Uu][Ee]/ AND registry.path:(/.*\\\\[Kk][Ee][Yy][Bb][Oo][Aa][Rr][Dd]\\ [Ll][Aa][Yy][Oo][Uu][Tt]\\\\[Pp][Rr][Ee][Ll][Oo][Aa][Dd]\\\\.*/ OR /.*\\\\[Kk][Ee][Yy][Bb][Oo][Aa][Rr][Dd]\\ [Ll][Aa][Yy][Oo][Uu][Tt]\\\\[Ss][Uu][Bb][Ss][Tt][Ii][Tt][Uu][Tt][Ee][Ss]\\\\.*/) AND winlog.event_data.Details:(/.*00000429.*/ OR /.*00050429.*/ OR /.*0000042[Aa].*/))","rule_id":"34aa0252-6039-40ff-951f-939fd6ce47d8","timestamp_override":"event.ingested","references":["https://renenyffenegger.ch/notes/Windows/registry/tree/HKEY_CURRENT_USER/Keyboard-Layout/Preload/index","https://github.com/SwiftOnSecurity/sysmon-config/pull/92/files"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(winlog.event_data.EventType:SetValue AND registry.path:(*\\\\Keyboard\\ Layout\\\\Preload\\\\* OR *\\\\Keyboard\\ Layout\\\\Substitutes\\\\*) AND winlog.event_data.Details:(*00000429* OR *00050429* OR *0000042a*))`"}
