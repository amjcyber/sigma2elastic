{"id":"ae9b0bd7-8888-4606-b444-0ed7410cb728","created_by":"Sreeman","name":"Writing Of Malicious Files To The Fonts Folder","tags":["attack.t1211","attack.t1059","attack.defense_evasion","attack.persistence"],"interval":"5m","description":"Monitors for the hiding possible malicious files in the C:\\Windows\\Fonts\\ location. This folder doesn't require admin privillege to be written and executed from.","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.command_line:(/.*[Ee][Cc][Hh][Oo].*/ OR /.*[Cc][Oo][Pp][Yy].*/ OR /.*[Tt][Yy][Pp][Ee].*/ OR /.*[Ff][Ii][Ll][Ee]\\ [Cc][Rr][Ee][Aa][Tt][Ee][Nn][Ee][Ww].*/ OR /.*[Cc][Aa][Cc][Ll][Ss].*/) AND process.command_line:/.*[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ff][Oo][Nn][Tt][Ss]\\\\.*/ AND process.command_line:(/.*\\.[Ss][Hh].*/ OR /.*\\.[Ee][Xx][Ee].*/ OR /.*\\.[Dd][Ll][Ll].*/ OR /.*\\.[Bb][Ii][Nn].*/ OR /.*\\.[Bb][Aa][Tt].*/ OR /.*\\.[Cc][Mm][Dd].*/ OR /.*\\.[Jj][Ss].*/ OR /.*\\.[Mm][Ss][Hh].*/ OR /.*\\.[Rr][Ee][Gg].*/ OR /.*\\.[Ss][Cc][Rr].*/ OR /.*\\.[Pp][Ss].*/ OR /.*\\.[Vv][Bb].*/ OR /.*\\.[Jj][Aa][Rr].*/ OR /.*\\.[Pp][Ll].*/ OR /.*\\.[Ii][Nn][Ff].*/ OR /.*\\.[Cc][Pp][Ll].*/ OR /.*\\.[Hh][Tt][Aa].*/ OR /.*\\.[Mm][Ss][Ii].*/ OR /.*\\.[Vv][Bb][Ss].*/))","rule_id":"ae9b0bd7-8888-4606-b444-0ed7410cb728","timestamp_override":"event.ingested","references":["https://thedfirreport.com/2020/04/20/sqlserver-or-the-miner-in-the-basement/"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.command_line:(*echo* OR *copy* OR *type* OR *file\\ createnew* OR *cacls*) AND process.command_line:*C\\:\\\\Windows\\\\Fonts\\\\* AND process.command_line:(*.sh* OR *.exe* OR *.dll* OR *.bin* OR *.bat* OR *.cmd* OR *.js* OR *.msh* OR *.reg* OR *.scr* OR *.ps* OR *.vb* OR *.jar* OR *.pl* OR *.inf* OR *.cpl* OR *.hta* OR *.msi* OR *.vbs*))`"}
