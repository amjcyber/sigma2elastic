{"id":"09706624-b7f6-455d-9d02-adee024cee1d","created_by":"Christian Burkard","name":"CobaltStrike BOF Injection Pattern","tags":["attack.execution","attack.t1106","attack.defense_evasion","attack.t1562.001"],"interval":"5m","description":"Detects a typical pattern of a CobaltStrike BOF which inject into other processes","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(winlog.event_data.CallTrace:/C:\\\\\\\\Windows\\\\\\\\SYSTEM32\\\\\\\\ntdll\\\\.dll\\+[a-z0-9]{4,6}\\|C:\\\\\\\\Windows\\\\\\\\System32\\\\\\\\KERNELBASE\\\\.dll\\+[a-z0-9]{4,6}\\|UNKNOWN\\([A-Z0-9]{16}\\)/ AND winlog.event_data.GrantedAccess:(/0[Xx]1028/ OR /0[Xx]1[Ff][Ff][Ff][Ff][Ff]/))","rule_id":"09706624-b7f6-455d-9d02-adee024cee1d","timestamp_override":"event.ingested","references":["https://github.com/boku7/injectAmsiBypass","https://github.com/boku7/spawn"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(winlog.event_data.CallTrace:/C:\\\\\\\\Windows\\\\\\\\SYSTEM32\\\\\\\\ntdll\\\\.dll\\+[a-z0-9]{4,6}\\|C:\\\\\\\\Windows\\\\\\\\System32\\\\\\\\KERNELBASE\\\\.dll\\+[a-z0-9]{4,6}\\|UNKNOWN\\([A-Z0-9]{16}\\)/ AND winlog.event_data.GrantedAccess:(0x1028 OR 0x1fffff))`"}
