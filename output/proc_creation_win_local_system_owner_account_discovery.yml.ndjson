{"id":"502b42de-4306-40b4-9596-6f590c81f073","created_by":"Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community","name":"Local Accounts Discovery","tags":["attack.discovery","attack.t1033","attack.t1087.001"],"interval":"5m","description":"Local accounts, System Owner/User discovery using operating systems utilities","risk_score":21,"enabled":true,"severity":"low","false_positives":["Legitimate administrator or user enumerates local users for legitimate reason"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(((process.executable:/.*\\\\[Ww][Hh][Oo][Aa][Mm][Ii]\\.[Ee][Xx][Ee]/ OR (process.executable:/.*\\\\[Ww][Mm][Ii][Cc]\\.[Ee][Xx][Ee]/ AND process.command_line:/.*[Uu][Ss][Ee][Rr][Aa][Cc][Cc][Oo][Uu][Nn][Tt].*/ AND process.command_line:/.*[Gg][Ee][Tt].*/) OR process.executable:(/.*\\\\[Qq][Uu][Ss][Ee][Rr]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Qq][Ww][Ii][Nn][Ss][Tt][Aa]\\.[Ee][Xx][Ee]/) OR (process.executable:/.*\\\\[Cc][Mm][Dd][Kk][Ee][Yy]\\.[Ee][Xx][Ee]/ AND process.command_line:/.*\\ \\/[Ll].*/) OR (process.executable:/.*\\\\[Cc][Mm][Dd]\\.[Ee][Xx][Ee]/ AND process.command_line:/.*\\ \\/[Cc].*/ AND process.command_line:/.*[Dd][Ii][Rr]\\ .*/ AND process.command_line:/.*\\\\[Uu][Ss][Ee][Rr][Ss]\\\\.*/)) AND (NOT (process.command_line:/.*\\ [Rr][Mm][Dd][Ii][Rr]\\ .*/))) OR ((process.executable:(/.*\\\\[Nn][Ee][Tt]\\.[Ee][Xx][Ee]/ OR /.*\\\\[Nn][Ee][Tt]1\\.[Ee][Xx][Ee]/) AND process.command_line:/.*[Uu][Ss][Ee][Rr].*/) AND (NOT (process.command_line:(/.*\\/[Dd][Oo][Mm][Aa][Ii][Nn].*/ OR /.*\\/[Aa][Dd][Dd].*/ OR /.*\\/[Dd][Ee][Ll][Ee][Tt][Ee].*/ OR /.*\\/[Aa][Cc][Tt][Ii][Vv][Ee].*/ OR /.*\\/[Ee][Xx][Pp][Ii][Rr][Ee][Ss].*/ OR /.*\\/[Pp][Aa][Ss][Ss][Ww][Oo][Rr][Dd][Rr][Ee][Qq].*/ OR /.*\\/[Ss][Cc][Rr][Ii][Pp][Tt][Pp][Aa][Tt][Hh].*/ OR /.*\\/[Tt][Ii][Mm][Ee][Ss].*/ OR /.*\\/[Ww][Oo][Rr][Kk][Ss][Tt][Aa][Tt][Ii][Oo][Nn][Ss].*/)))))","rule_id":"502b42de-4306-40b4-9596-6f590c81f073","timestamp_override":"event.ingested","references":["https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1033/T1033.md"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(((process.executable:*\\\\whoami.exe OR (process.executable:*\\\\wmic.exe AND process.command_line:*useraccount* AND process.command_line:*get*) OR process.executable:(*\\\\quser.exe OR *\\\\qwinsta.exe) OR (process.executable:*\\\\cmdkey.exe AND process.command_line:*\\ \\/l*) OR (process.executable:*\\\\cmd.exe AND process.command_line:*\\ \\/c* AND process.command_line:*dir\\ * AND process.command_line:*\\\\Users\\\\*)) AND (NOT (process.command_line:*\\ rmdir\\ *))) OR ((process.executable:(*\\\\net.exe OR *\\\\net1.exe) AND process.command_line:*user*) AND (NOT (process.command_line:(*\\/domain* OR *\\/add* OR *\\/delete* OR *\\/active* OR *\\/expires* OR *\\/passwordreq* OR *\\/scriptpath* OR *\\/times* OR *\\/workstations*)))))`"}
