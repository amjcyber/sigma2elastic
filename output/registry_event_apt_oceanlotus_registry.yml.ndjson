{"id":"4ac5fc44-a601-4c06-955b-309df8c4e9d4","created_by":"megan201296, Jonhnathan Ribeiro","name":"OceanLotus Registry Activity","tags":["attack.defense_evasion","attack.t1112"],"interval":"5m","description":"Detects registry keys created in OceanLotus (also known as APT32) attacks","risk_score":99,"enabled":true,"severity":"critical","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(registry.path:/[Hh][Kk][Cc][Uu]\\\\[Ss][Oo][Ff][Tt][Ww][Aa][Rr][Ee]\\\\[Cc][Ll][Aa][Ss][Ss][Ee][Ss]\\\\[Cc][Ll][Ss][Ii][Dd]\\\\\\{[Ee]08[Aa]0[Ff]4[Bb]\\-1[Ff]65\\-4[Dd]4[Dd]\\-9[Aa]09\\-[Bb][Dd]4625[Bb]9[Cc]5[Aa]1\\}\\\\[Mm][Oo][Dd][Ee][Ll]/ OR (registry.path:(/[Hh][Kk][Cc][Uu]\\\\[Ss][Oo][Ff][Tt][Ww][Aa][Rr][Ee]\\\\[Aa][Pp][Pp]\\\\.*/ OR /[Hh][Kk][Ll][Mm]\\\\[Ss][Oo][Ff][Tt][Ww][Aa][Rr][Ee]\\\\[Aa][Pp][Pp]\\\\.*/) AND registry.path:(/.*[Aa][Pp][Pp][Xx][Bb][Ff]13[Dd]4[Ee][Aa]2945444[Dd]8[Bb]13[Ee]2121[Cc][Bb]6[Bb]663\\\\.*/ OR /.*[Aa][Pp][Pp][Xx]70162486[Cc]7554[Ff]7[Ff]80[Ff]481985[Dd]67586[Dd]\\\\.*/ OR /.*[Aa][Pp][Pp][Xx]37[Cc][Cc]7[Ff][Dd][Cc][Cc][Dd]644[Bb]4[Ff]85[Ff]4[Bb]22[Dd]5[Aa]3[Ff]105[Aa]\\\\.*/) AND registry.path:(/.*[Aa][Pp][Pp][Ll][Ii][Cc][Aa][Tt][Ii][Oo][Nn]/ OR /.*[Dd][Ee][Ff][Aa][Uu][Ll][Tt][Ii][Cc][Oo][Nn]/)) OR (registry.path:/[Hh][Kk][Cc][Uu]\\\\.*/ AND registry.path:(/.*[Cc][Ll][Aa][Ss][Ss][Ee][Ss]\\\\[Aa][Pp][Pp][Xx][Cc]52346[Ee][Cc]40[Ff][Bb]4061[Aa][Dd]96[Bb][Ee]0[Ee]6[Cc][Bb]7[Dd]16[Aa]\\\\.*/ OR /.*[Cc][Ll][Aa][Ss][Ss][Ee][Ss]\\\\[Aa][Pp][Pp][Xx]3[Bb][Bb][Bb][Aa]44[Cc]6[Cc][Aa][Ee]4[Dd]9695755183472171[Ee]2\\\\.*/ OR /.*[Cc][Ll][Aa][Ss][Ss][Ee][Ss]\\\\[Cc][Ll][Ss][Ii][Dd]\\\\\\{[Ee]3517[Ee]26\\-8[Ee]93\\-458[Dd]\\-[Aa]6[Dd][Ff]\\-8030[Bb][Cc]80528[Bb]\\}\\\\.*/ OR /.*[Cc][Ll][Aa][Ss][Ss][Ee][Ss]\\\\[Cc][Ll][Ss][Ii][Dd]\\\\\\{[Ee]08[Aa]0[Ff]4[Bb]\\-1[Ff]65\\-4[Dd]4[Dd]\\-9[Aa]09\\-[Bb][Dd]4625[Bb]9[Cc]5[Aa]1\\}\\\\[Mm][Oo][Dd][Ee][Ll].*/)))","rule_id":"4ac5fc44-a601-4c06-955b-309df8c4e9d4","timestamp_override":"event.ingested","references":["https://www.welivesecurity.com/2019/03/20/fake-or-fake-keeping-up-with-oceanlotus-decoys/","https://github.com/eset/malware-ioc/tree/master/oceanlotus"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(registry.path:HKCU\\\\SOFTWARE\\\\Classes\\\\CLSID\\\\\\{E08A0F4B\\-1F65\\-4D4D\\-9A09\\-BD4625B9C5A1\\}\\\\Model OR (registry.path:(HKCU\\\\SOFTWARE\\\\App\\\\* OR HKLM\\\\SOFTWARE\\\\App\\\\*) AND registry.path:(*AppXbf13d4ea2945444d8b13e2121cb6b663\\\\* OR *AppX70162486c7554f7f80f481985d67586d\\\\* OR *AppX37cc7fdccd644b4f85f4b22d5a3f105a\\\\*) AND registry.path:(*Application OR *DefaultIcon)) OR (registry.path:HKCU\\\\* AND registry.path:(*Classes\\\\AppXc52346ec40fb4061ad96be0e6cb7d16a\\\\* OR *Classes\\\\AppX3bbba44c6cae4d9695755183472171e2\\\\* OR *Classes\\\\CLSID\\\\\\{E3517E26\\-8E93\\-458D\\-A6DF\\-8030BC80528B\\}\\\\* OR *Classes\\\\CLSID\\\\\\{E08A0F4B\\-1F65\\-4D4D\\-9A09\\-BD4625B9C5A1\\}\\\\Model*)))`"}
