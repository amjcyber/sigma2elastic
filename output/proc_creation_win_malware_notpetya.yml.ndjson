{"id":"79aeeb41-8156-4fac-a0cd-076495ab82a1","created_by":"Florian Roth, Tom Ueltschi","name":"NotPetya Ransomware Activity","tags":["attack.defense_evasion","attack.t1218.011","attack.t1070.001","attack.credential_access","attack.t1003.001","car.2016-04-002"],"interval":"5m","description":"Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil","risk_score":99,"enabled":true,"severity":"critical","false_positives":["Admin activity"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((process.command_line:/.*\\\\[Aa][Pp][Pp][Dd][Aa][Tt][Aa]\\\\[Ll][Oo][Cc][Aa][Ll]\\\\[Tt][Ee][Mm][Pp]\\\\.*/ AND process.command_line:/.*\\\\\\\\\\.\\\\[Pp][Ii][Pp][Ee]\\\\\\*/) OR (process.executable:/.*\\\\[Rr][Uu][Nn][Dd][Ll][Ll]32\\.[Ee][Xx][Ee]/ AND process.command_line:(/.*\\.[Dd][Aa][Tt],#1/ OR /.*\\.[Dd][Aa][Tt]\\ #1/)) OR /\\\\[Pp][Ee][Rr][Ff][Cc]\\.[Dd][Aa][Tt]/)","rule_id":"79aeeb41-8156-4fac-a0cd-076495ab82a1","timestamp_override":"event.ingested","references":["https://securelist.com/schroedingers-petya/78870/","https://www.hybrid-analysis.com/sample/64b0b58a2c030c77fdb2b537b2fcc4af432bc55ffb36599a31d418c7c69e94b1?environmentId=100"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((process.command_line:*\\\\AppData\\\\Local\\\\Temp\\\\* AND process.command_line:*\\\\\\\\.\\\\pipe\\\\\\*) OR (process.executable:*\\\\rundll32.exe AND process.command_line:(*.dat,#1 OR *.dat\\ #1)) OR \\\\perfc.dat)`"}
