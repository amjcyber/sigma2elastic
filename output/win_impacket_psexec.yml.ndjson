{"id":"32d56ea1-417f-44ff-822b-882873f5f43b","created_by":"Bhabesh Raj","name":"Impacket PsExec Execution","tags":["attack.lateral_movement","attack.t1021.002"],"interval":"5m","description":"Detects execution of Impacket's psexec.py.","risk_score":73,"enabled":true,"severity":"high","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(winlog.channel:Security AND event.code:5145 AND winlog.event_data.ShareName:/\\\\\\\\\\*\\\\[Ii][Pp][Cc]$/ AND winlog.event_data.RelativeTargetName:(/.*[Rr][Ee][Mm][Cc][Oo][Mm]_[Ss][Tt][Dd][Ii][Nn][Tt].*/ OR /.*[Rr][Ee][Mm][Cc][Oo][Mm]_[Ss][Tt][Dd][Oo][Uu][Tt][Tt].*/ OR /.*[Rr][Ee][Mm][Cc][Oo][Mm]_[Ss][Tt][Dd][Ee][Rr][Rr][Tt].*/))","rule_id":"32d56ea1-417f-44ff-822b-882873f5f43b","timestamp_override":"event.ingested","references":["https://blog.menasec.net/2019/02/threat-hunting-3-detecting-psexec.html"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(winlog.channel:Security AND event.code:5145 AND winlog.event_data.ShareName:\\\\\\\\\\*\\\\IPC$ AND winlog.event_data.RelativeTargetName:(*RemCom_stdint* OR *RemCom_stdoutt* OR *RemCom_stderrt*))`"}
