{"id":"e0813366-0407-449a-9869-a2db1119dc41","created_by":"Florian Roth","name":"Suspicious Printer Driver Empty Manufacturer","tags":["attack.privilege_escalation","attack.t1574","cve.2021.1675"],"interval":"5m","description":"Detects a suspicious printer driver installation with an empty Manufacturer value","risk_score":73,"enabled":true,"severity":"high","false_positives":["Alerts on legitimate printer drivers that do not set any more details in the Manufacturer value"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"((winlog.event_data.EventType:/[Ss][Ee][Tt][Vv][Aa][Ll][Uu][Ee]/ AND registry.path:/.*\\\\[Cc][Oo][Nn][Tt][Rr][Oo][Ll]\\\\[Pp][Rr][Ii][Nn][Tt]\\\\[Ee][Nn][Vv][Ii][Rr][Oo][Nn][Mm][Ee][Nn][Tt][Ss]\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\ [Xx]64\\\\[Dd][Rr][Ii][Vv][Ee][Rr][Ss].*/ AND registry.path:/.*\\\\[Mm][Aa][Nn][Uu][Ff][Aa][Cc][Tt][Uu][Rr][Ee][Rr].*/ AND winlog.event_data.Details:/\\([Ee][Mm][Pp][Tt][Yy]\\)/) AND (NOT ((registry.path:/.*\\\\[Cc][Uu][Tt][Ee][Pp][Dd][Ff]\\ [Ww][Rr][Ii][Tt][Ee][Rr]\\ [Vv]4\\.0\\\\.*/))))","rule_id":"e0813366-0407-449a-9869-a2db1119dc41","timestamp_override":"event.ingested","references":["https://twitter.com/SBousseaden/status/1410545674773467140"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`((winlog.event_data.EventType:SetValue AND registry.path:*\\\\Control\\\\Print\\\\Environments\\\\Windows\\ x64\\\\Drivers* AND registry.path:*\\\\Manufacturer* AND winlog.event_data.Details:\\(Empty\\)) AND (NOT ((registry.path:*\\\\CutePDF\\ Writer\\ v4.0\\\\*))))`"}
