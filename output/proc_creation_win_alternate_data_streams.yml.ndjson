{"id":"7f43c430-5001-4f8b-aaa9-c3b88f18fa5c","created_by":"frack113","name":"Execute From Alternate Data Streams","tags":["attack.defense_evasion","attack.t1564.004"],"interval":"5m","description":"Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection","risk_score":47,"enabled":true,"severity":"medium","false_positives":["Unknown"],"from":"now-720s","type":"query","language":"lucene","index":["winlogbeat-*","logs-*"],"query":"(process.command_line:/.*[Tt][Xx][Tt]\\:.*/ AND ((process.command_line:/.*[Tt][Yy][Pp][Ee]\\ .*/ AND process.command_line:/.*\\ \\>\\ .*/) OR (process.command_line:/.*[Mm][Aa][Kk][Ee][Cc][Aa][Bb]\\ .*/ AND process.command_line:/.*\\.[Cc][Aa][Bb].*/) OR (process.command_line:/.*[Rr][Ee][Gg]\\ .*/ AND process.command_line:/.*\\ [Ee][Xx][Pp][Oo][Rr][Tt]\\ .*/) OR (process.command_line:/.*[Rr][Ee][Gg][Ee][Dd][Ii][Tt]\\ .*/ AND process.command_line:/.*\\ \\/[Ee]\\ .*/) OR (process.command_line:/.*[Ee][Ss][Ee][Nn][Tt][Uu][Tt][Ll]\\ .*/ AND process.command_line:/.*\\ \\/[Yy]\\ .*/ AND process.command_line:/.*\\ \\/[Dd]\\ .*/ AND process.command_line:/.*\\ \\/[Oo]\\ .*/)))","rule_id":"7f43c430-5001-4f8b-aaa9-c3b88f18fa5c","timestamp_override":"event.ingested","references":["https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.004/T1564.004.md"],"note":"**Detection Rule without Regex for better understanding. Be careful, this way is case sensitive:**`(process.command_line:*txt\\:* AND ((process.command_line:*type\\ * AND process.command_line:*\\ >\\ *) OR (process.command_line:*makecab\\ * AND process.command_line:*.cab*) OR (process.command_line:*reg\\ * AND process.command_line:*\\ export\\ *) OR (process.command_line:*regedit\\ * AND process.command_line:*\\ \\/E\\ *) OR (process.command_line:*esentutl\\ * AND process.command_line:*\\ \\/y\\ * AND process.command_line:*\\ \\/d\\ * AND process.command_line:*\\ \\/o\\ *)))`"}
